1702249015
waR3U4bTeM%3Ae1b41dcfd5100b527d279d27ba60f563-539b4ffbb7251b2d170dda70a06deefa
s:145920:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxNDp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6IjUzOWI0ZmZiYjcyNTFiMmQxNzBkZGE3MGEwNmRlZWZhIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWUiO3M6MzY6IjgxZDMwMmQ3YWExNWFmMWJjYTFjMTMzNTIxOTdiZjlmLnBocCI7czozOToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBwYXRoIjtzOjU4OiJ2YXIvY2FjaGUvZGV2L3R3aWcvODEvODFkMzAyZDdhYTE1YWYxYmNhMWMxMzM1MjE5N2JmOWYucGhwIjtzOjQxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHNvdXJjZSI7czo5Mjc0MjoiPD9waHAKCnVzZSBUd2lnXEVudmlyb25tZW50Owp1c2UgVHdpZ1xFcnJvclxMb2FkZXJFcnJvcjsKdXNlIFR3aWdcRXJyb3JcUnVudGltZUVycm9yOwp1c2UgVHdpZ1xFeHRlbnNpb25cU2FuZGJveEV4dGVuc2lvbjsKdXNlIFR3aWdcTWFya3VwOwp1c2UgVHdpZ1xTYW5kYm94XFNlY3VyaXR5RXJyb3I7CnVzZSBUd2lnXFNhbmRib3hcU2VjdXJpdHlOb3RBbGxvd2VkVGFnRXJyb3I7CnVzZSBUd2lnXFNhbmRib3hcU2VjdXJpdHlOb3RBbGxvd2VkRmlsdGVyRXJyb3I7CnVzZSBUd2lnXFNhbmRib3hcU2VjdXJpdHlOb3RBbGxvd2VkRnVuY3Rpb25FcnJvcjsKdXNlIFR3aWdcU291cmNlOwp1c2UgVHdpZ1xUZW1wbGF0ZTsKCi8qIEBXZWJQcm9maWxlci9Qcm9maWxlci9iYXNlX2pzLmh0bWwudHdpZyAqLwpjbGFzcyBfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYSBleHRlbmRzIFRlbXBsYXRlCnsKICAgIHByaXZhdGUgJHNvdXJjZTsKICAgIHByaXZhdGUgJG1hY3JvcyA9IFtdOwoKICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdChFbnZpcm9ubWVudCAkZW52KQogICAgewogICAgICAgIHBhcmVudDo6X19jb25zdHJ1Y3QoJGVudik7CgogICAgICAgICR0aGlzLT5zb3VyY2UgPSAkdGhpcy0+Z2V0U291cmNlQ29udGV4dCgpOwoKICAgICAgICAkdGhpcy0+cGFyZW50ID0gZmFsc2U7CgogICAgICAgICR0aGlzLT5ibG9ja3MgPSBbCiAgICAgICAgXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZG9EaXNwbGF5KGFycmF5ICRjb250ZXh0LCBhcnJheSAkYmxvY2tzID0gW10pCiAgICB7CiAgICAgICAgJG1hY3JvcyA9ICR0aGlzLT5tYWNyb3M7CiAgICAgICAgJF9faW50ZXJuYWxfNWEyN2E4YmEyMWNhNzliNjE5MzIzNzZiMmZhOTIyZDIgPSAkdGhpcy0+ZXh0ZW5zaW9uc1siU3ltZm9ueVxcQnVuZGxlXFxXZWJQcm9maWxlckJ1bmRsZVxcVHdpZ1xcV2ViUHJvZmlsZXJFeHRlbnNpb24iXTsKICAgICAgICAkX19pbnRlcm5hbF81YTI3YThiYTIxY2E3OWI2MTkzMjM3NmIyZmE5MjJkMi0+ZW50ZXIoJF9faW50ZXJuYWxfNWEyN2E4YmEyMWNhNzliNjE5MzIzNzZiMmZhOTIyZDJfcHJvZiA9IG5ldyBcVHdpZ1xQcm9maWxlclxQcm9maWxlKCR0aGlzLT5nZXRUZW1wbGF0ZU5hbWUoKSwgInRlbXBsYXRlIiwgIkBXZWJQcm9maWxlci9Qcm9maWxlci9iYXNlX2pzLmh0bWwudHdpZyIpKTsKCiAgICAgICAgJF9faW50ZXJuYWxfNmY0N2JiZTk5ODNhZjgxZjFlNzQ1MGU5YTNlMzc2OGYgPSAkdGhpcy0+ZXh0ZW5zaW9uc1siU3ltZm9ueVxcQnJpZGdlXFxUd2lnXFxFeHRlbnNpb25cXFByb2ZpbGVyRXh0ZW5zaW9uIl07CiAgICAgICAgJF9faW50ZXJuYWxfNmY0N2JiZTk5ODNhZjgxZjFlNzQ1MGU5YTNlMzc2OGYtPmVudGVyKCRfX2ludGVybmFsXzZmNDdiYmU5OTgzYWY4MWYxZTc0NTBlOWEzZTM3NjhmX3Byb2YgPSBuZXcgXFR3aWdcUHJvZmlsZXJcUHJvZmlsZSgkdGhpcy0+Z2V0VGVtcGxhdGVOYW1lKCksICJ0ZW1wbGF0ZSIsICJAV2ViUHJvZmlsZXIvUHJvZmlsZXIvYmFzZV9qcy5odG1sLnR3aWciKSk7CgogICAgICAgIC8vIGxpbmUgMwogICAgICAgIGVjaG8gIjxzY3JpcHQiOwogICAgICAgIGlmICgoYXJyYXlfa2V5X2V4aXN0cygiY3NwX3NjcmlwdF9ub25jZSIsICRjb250ZXh0KSAmJiAoaXNzZXQoJGNvbnRleHRbImNzcF9zY3JpcHRfbm9uY2UiXSkgfHwgYXJyYXlfa2V5X2V4aXN0cygiY3NwX3NjcmlwdF9ub25jZSIsICRjb250ZXh0KSA/ICRjb250ZXh0WyJjc3Bfc2NyaXB0X25vbmNlIl0gOiAoZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgUnVudGltZUVycm9yKCdWYXJpYWJsZSAiY3NwX3NjcmlwdF9ub25jZSIgZG9lcyBub3QgZXhpc3QuJywgMywgJHRoaXMtPnNvdXJjZSk7IH0pKCkpKSkgewogICAgICAgICAgICBlY2hvICIgbm9uY2U9XCIiOwogICAgICAgICAgICBlY2hvIHR3aWdfZXNjYXBlX2ZpbHRlcigkdGhpcy0+ZW52LCAoaXNzZXQoJGNvbnRleHRbImNzcF9zY3JpcHRfbm9uY2UiXSkgfHwgYXJyYXlfa2V5X2V4aXN0cygiY3NwX3NjcmlwdF9ub25jZSIsICRjb250ZXh0KSA/ICRjb250ZXh0WyJjc3Bfc2NyaXB0X25vbmNlIl0gOiAoZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgUnVudGltZUVycm9yKCdWYXJpYWJsZSAiY3NwX3NjcmlwdF9ub25jZSIgZG9lcyBub3QgZXhpc3QuJywgMywgJHRoaXMtPnNvdXJjZSk7IH0pKCkpLCAiaHRtbCIsIG51bGwsIHRydWUpOwogICAgICAgICAgICBlY2hvICJcIiI7CiAgICAgICAgfQogICAgICAgIGVjaG8gIj4vKjwhW0NEQVRBWyovCiAgICAiOwogICAgICAgIC8vIGxpbmUgNwogICAgICAgIGVjaG8gIgppZiAodHlwZW9mIFNmanMgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBTZmpzLmxvYWRUb29sYmFyID09PSAndW5kZWZpbmVkJykgewogICAgU2ZqcyA9IChmdW5jdGlvbigpIHsKICAgICAgICBcInVzZSBzdHJpY3RcIjsKCiAgICAgICAgaWYgKCdjbGFzc0xpc3QnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgewogICAgICAgICAgICB2YXIgaGFzQ2xhc3MgPSBmdW5jdGlvbiAoZWwsIGNzc0NsYXNzKSB7IHJldHVybiBlbC5jbGFzc0xpc3QuY29udGFpbnMoY3NzQ2xhc3MpOyB9OwogICAgICAgICAgICB2YXIgcmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgZWwuY2xhc3NMaXN0LnJlbW92ZShjc3NDbGFzcyk7IH07CiAgICAgICAgICAgIHZhciBhZGRDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBlbC5jbGFzc0xpc3QuYWRkKGNzc0NsYXNzKTsgfTsKICAgICAgICAgICAgdmFyIHRvZ2dsZUNsYXNzID0gZnVuY3Rpb24oZWwsIGNzc0NsYXNzKSB7IGVsLmNsYXNzTGlzdC50b2dnbGUoY3NzQ2xhc3MpOyB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBoYXNDbGFzcyA9IGZ1bmN0aW9uIChlbCwgY3NzQ2xhc3MpIHsgcmV0dXJuIGVsLmNsYXNzTmFtZS5tYXRjaChuZXcgUmVnRXhwKCdcXFxcYicgKyBjc3NDbGFzcyArICdcXFxcYicpKTsgfTsKICAgICAgICAgICAgdmFyIHJlbW92ZUNsYXNzID0gZnVuY3Rpb24oZWwsIGNzc0NsYXNzKSB7IGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcXFxiJyArIGNzc0NsYXNzICsgJ1xcXFxiJyksICcgJyk7IH07CiAgICAgICAgICAgIHZhciBhZGRDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBpZiAoIWhhc0NsYXNzKGVsLCBjc3NDbGFzcykpIHsgZWwuY2xhc3NOYW1lICs9IFwiIFwiICsgY3NzQ2xhc3M7IH0gfTsKICAgICAgICAgICAgdmFyIHRvZ2dsZUNsYXNzID0gZnVuY3Rpb24oZWwsIGNzc0NsYXNzKSB7IGhhc0NsYXNzKGVsLCBjc3NDbGFzcykgPyByZW1vdmVDbGFzcyhlbCwgY3NzQ2xhc3MpIDogYWRkQ2xhc3MoZWwsIGNzc0NsYXNzKTsgfTsKICAgICAgICB9CgogICAgICAgIHZhciBub29wID0gZnVuY3Rpb24oKSB7fTsKCiAgICAgICAgdmFyIHByb2ZpbGVyU3RvcmFnZUtleSA9ICdzeW1mb255L3Byb2ZpbGVyLyc7CgogICAgICAgIHZhciBhZGRFdmVudExpc3RlbmVyOwoKICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBpZiAoISgnYWRkRXZlbnRMaXN0ZW5lcicgaW4gZWwpKSB7CiAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgICAgICAgICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgnb24nICsgZXZlbnROYW1lLCBjYWxsYmFjayk7CiAgICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIChlbGVtZW50LCBldmVudE5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBjYWxsYmFjaywgZmFsc2UpOwogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgaWYgKG5hdmlnYXRvci5jbGlwYm9hcmQpIHsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsICgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlICE9PSAnY29tcGxldGUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWNsaXBib2FyZC10ZXh0XScpLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhlbGVtZW50LCAnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2xpcGJvYXJkLXRleHQnKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJsYWJlbFwiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9sZENvbnRlbnQgPSBlbGVtZW50LnRleHRDb250ZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSBcIuKchSBDb3BpZWQhXCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJzdGF0dXMtc3VjY2Vzc1wiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gb2xkQ29udGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJzdGF0dXMtc3VjY2Vzc1wiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDcwMDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVxdWVzdCA9IGZ1bmN0aW9uKHVybCwgb25TdWNjZXNzLCBvbkVycm9yLCBwYXlsb2FkLCBvcHRpb25zLCB0cmllcykgewogICAgICAgICAgICB2YXIgeGhyID0gd2luZG93LlhNTEh0dHBSZXF1ZXN0ID8gbmV3IFhNTEh0dHBSZXF1ZXN0KCkgOiBuZXcgQWN0aXZlWE9iamVjdCgnTWljcm9zb2Z0LlhNTEhUVFAnKTsKICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgICAgIG9wdGlvbnMucmV0cnkgPSBvcHRpb25zLnJldHJ5IHx8IGZhbHNlOwogICAgICAgICAgICB0cmllcyA9IHRyaWVzIHx8IDE7CiAgICAgICAgICAgIC8qIHRoaXMgZGVsYXlzIGZvciAxMjUsIDM3NSwgNjI1LCA4NzUsIGFuZCAxMDAwLCAuLi4gKi8KICAgICAgICAgICAgdmFyIGRlbGF5ID0gdHJpZXMgPCA1ID8gKHRyaWVzIC0gMC41KSAqIDI1MCA6IDEwMDA7CgogICAgICAgICAgICB4aHIub3BlbihvcHRpb25zLm1ldGhvZCB8fCAnR0VUJywgdXJsLCB0cnVlKTsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCAnWE1MSHR0cFJlcXVlc3QnKTsKICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgICAgICAgICAgICBpZiAoNCAhPT0geGhyLnJlYWR5U3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PSA0MDQgJiYgb3B0aW9ucy5yZXRyeSAmJiAhb3B0aW9ucy5zdG9wKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RvcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QodXJsLCBvblN1Y2Nlc3MsIG9uRXJyb3IsIHBheWxvYWQsIG9wdGlvbnMsIHRyaWVzICsgMSk7CiAgICAgICAgICAgICAgICAgICAgfSwgZGVsYXkpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoMjAwID09PSB4aHIuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgKG9uU3VjY2VzcyB8fCBub29wKSh4aHIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAob25FcnJvciB8fCBub29wKSh4aHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMub25TZW5kKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLm9uU2VuZCh0cmllcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHhoci5zZW5kKHBheWxvYWQgfHwgJycpOwogICAgICAgIH07CgogICAgICAgIHZhciBnZXRQcmVmZXJlbmNlID0gZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvZmlsZXJTdG9yYWdlS2V5ICsgbmFtZSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHNldFByZWZlcmVuY2UgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShwcm9maWxlclN0b3JhZ2VLZXkgKyBuYW1lLCB2YWx1ZSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHJlcXVlc3RTdGFjayA9IFtdOwoKICAgICAgICB2YXIgZXh0cmFjdEhlYWRlcnMgPSBmdW5jdGlvbih4aHIsIHN0YWNrRWxlbWVudCkgewogICAgICAgICAgICAvKiBIZXJlIHdlIGF2b2lkIHRvIGNhbGwgeGhyLmdldFJlc3BvbnNlSGVhZGVyIGluIG9yZGVyIHRvICovCiAgICAgICAgICAgIC8qIHByZXZlbnQgcG9sbHV0aW5nIHRoZSBjb25zb2xlIHdpdGggQ09SUyBzZWN1cml0eSBlcnJvcnMgKi8KICAgICAgICAgICAgdmFyIGFsbEhlYWRlcnMgPSB4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCk7CiAgICAgICAgICAgIHZhciByZXQ7CgogICAgICAgICAgICBpZiAocmV0ID0gYWxsSGVhZGVycy5tYXRjaCgvXngtZGVidWctdG9rZW46XFxzKyguKilcJC9pbSkpIHsKICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5wcm9maWxlID0gcmV0WzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXQgPSBhbGxIZWFkZXJzLm1hdGNoKC9eeC1kZWJ1Zy10b2tlbi1saW5rOlxccysoLiopXCQvaW0pKSB7CiAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQucHJvZmlsZXJVcmwgPSByZXRbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJldCA9IGFsbEhlYWRlcnMubWF0Y2goL15TeW1mb255LURlYnVnLVRvb2xiYXItUmVwbGFjZTpcXHMrKC4qKVwkL2ltKSkgewogICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnRvb2xiYXJSZXBsYWNlRmluaXNoZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC50b29sYmFyUmVwbGFjZSA9ICcxJyA9PT0gcmV0WzFdOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHN1Y2Nlc3NTdHJlYWsgPSA0OwogICAgICAgIHZhciBwZW5kaW5nUmVxdWVzdHMgPSAwOwogICAgICAgIHZhciByZW5kZXJBamF4UmVxdWVzdHMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHJlcXVlc3RDb3VudGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYWpheC1yZXF1ZXN0LWNvdW50ZXInKTsKICAgICAgICAgICAgaWYgKCFyZXF1ZXN0Q291bnRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVlc3RDb3VudGVyLnRleHRDb250ZW50ID0gcmVxdWVzdFN0YWNrLmxlbmd0aDsKCiAgICAgICAgICAgIHZhciBpbmZvU3BhbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2YtdG9vbGJhci1hamF4LWluZm9cIik7CiAgICAgICAgICAgIGlmIChpbmZvU3BhbikgewogICAgICAgICAgICAgICAgaW5mb1NwYW4udGV4dENvbnRlbnQgPSByZXF1ZXN0U3RhY2subGVuZ3RoICsgJyBBSkFYIHJlcXVlc3QnICsgKHJlcXVlc3RTdGFjay5sZW5ndGggIT09IDEgPyAncycgOiAnJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhamF4VG9vbGJhclBhbmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stYWpheCcpOwogICAgICAgICAgICBpZiAocmVxdWVzdFN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICAgICAgYWpheFRvb2xiYXJQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFqYXhUb29sYmFyUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGVuZGluZ1JlcXVlc3RzID4gMCkgewogICAgICAgICAgICAgICAgYWRkQ2xhc3MoYWpheFRvb2xiYXJQYW5lbCwgJ3NmLWFqYXgtcmVxdWVzdC1sb2FkaW5nJyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VjY2Vzc1N0cmVhayA8IDQpIHsKICAgICAgICAgICAgICAgIGFkZENsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi10b29sYmFyLXN0YXR1cy1yZWQnKTsKICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi1hamF4LXJlcXVlc3QtbG9hZGluZycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoYWpheFRvb2xiYXJQYW5lbCwgJ3NmLWFqYXgtcmVxdWVzdC1sb2FkaW5nJyk7CiAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhhamF4VG9vbGJhclBhbmVsLCAnc2YtdG9vbGJhci1zdGF0dXMtcmVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB2YXIgc3RhcnRBamF4UmVxdWVzdCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgIHZhciB0Ym9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtcmVxdWVzdC1saXN0Jyk7CiAgICAgICAgICAgIGlmICghdGJvZHkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG5iT2ZBamF4UmVxdWVzdCA9IHRib2R5LnJvd3MubGVuZ3RoOwogICAgICAgICAgICBpZiAobmJPZkFqYXhSZXF1ZXN0ID49IDEwMCkgewogICAgICAgICAgICAgICAgdGJvZHkuZGVsZXRlUm93KDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHJlcXVlc3RTdGFja1tpbmRleF07CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cysrOwogICAgICAgICAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgcmVxdWVzdC5ET01Ob2RlID0gcm93OwoKICAgICAgICAgICAgdmFyIHJlcXVlc3ROdW1iZXJDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgcmVxdWVzdE51bWJlckNlbGwudGV4dENvbnRlbnQgPSBpbmRleCArIDE7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChyZXF1ZXN0TnVtYmVyQ2VsbCk7CgogICAgICAgICAgICB2YXIgcHJvZmlsZXJDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgcHJvZmlsZXJDZWxsLnRleHRDb250ZW50ID0gJ24vYSc7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChwcm9maWxlckNlbGwpOwoKICAgICAgICAgICAgdmFyIG1ldGhvZENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICBtZXRob2RDZWxsLnRleHRDb250ZW50ID0gcmVxdWVzdC5tZXRob2Q7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChtZXRob2RDZWxsKTsKCiAgICAgICAgICAgIHZhciB0eXBlQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIHR5cGVDZWxsLnRleHRDb250ZW50ID0gcmVxdWVzdC50eXBlOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQodHlwZUNlbGwpOwoKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGVDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgIHN0YXR1c0NvZGUudGV4dENvbnRlbnQgPSAnbi9hJzsKICAgICAgICAgICAgc3RhdHVzQ29kZUNlbGwuYXBwZW5kQ2hpbGQoc3RhdHVzQ29kZSk7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChzdGF0dXNDb2RlQ2VsbCk7CgogICAgICAgICAgICB2YXIgcGF0aENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICBwYXRoQ2VsbC5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0LXVybCc7CiAgICAgICAgICAgIGlmICgnR0VUJyA9PT0gcmVxdWVzdC5tZXRob2QpIHsKICAgICAgICAgICAgICAgIHZhciBwYXRoTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgICAgIHBhdGhMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHJlcXVlc3QudXJsKTsKICAgICAgICAgICAgICAgIHBhdGhMaW5rLnRleHRDb250ZW50ID0gcmVxdWVzdC51cmw7CiAgICAgICAgICAgICAgICBwYXRoQ2VsbC5hcHBlbmRDaGlsZChwYXRoTGluayk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXRoQ2VsbC50ZXh0Q29udGVudCA9IHJlcXVlc3QudXJsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhdGhDZWxsLnNldEF0dHJpYnV0ZSgndGl0bGUnLCByZXF1ZXN0LnVybCk7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChwYXRoQ2VsbCk7CgogICAgICAgICAgICB2YXIgZHVyYXRpb25DZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgZHVyYXRpb25DZWxsLmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3QtZHVyYXRpb24nOwogICAgICAgICAgICBkdXJhdGlvbkNlbGwudGV4dENvbnRlbnQgPSAnbi9hJzsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKGR1cmF0aW9uQ2VsbCk7CgogICAgICAgICAgICByZXF1ZXN0LmxpdmVEdXJhdGlvbkhhbmRsZSA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZHVyYXRpb25DZWxsLnRleHRDb250ZW50ID0gKG5ldyBEYXRlKCkgLSByZXF1ZXN0LnN0YXJ0KSArICcgbXMnOwogICAgICAgICAgICB9LCAxMDApOwoKICAgICAgICAgICAgcm93LmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3Qgc2YtYWpheC1yZXF1ZXN0LWxvYWRpbmcnOwogICAgICAgICAgICB0Ym9keS5pbnNlcnRCZWZvcmUocm93LCBudWxsKTsKCiAgICAgICAgICAgIHZhciB0b29sYmFySW5mbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWJsb2NrLWFqYXggLnNmLXRvb2xiYXItaW5mbycpOwogICAgICAgICAgICB0b29sYmFySW5mby5zY3JvbGxUb3AgPSB0b29sYmFySW5mby5zY3JvbGxIZWlnaHQ7CgogICAgICAgICAgICByZW5kZXJBamF4UmVxdWVzdHMoKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgZmluaXNoQWpheFJlcXVlc3QgPSBmdW5jdGlvbihpbmRleCkgewogICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHJlcXVlc3RTdGFja1tpbmRleF07CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocmVxdWVzdC5saXZlRHVyYXRpb25IYW5kbGUpOwoKICAgICAgICAgICAgaWYgKCFyZXF1ZXN0LkRPTU5vZGUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlcXVlc3QudG9vbGJhclJlcGxhY2UgJiYgIXJlcXVlc3QudG9vbGJhclJlcGxhY2VGaW5pc2hlZCAmJiByZXF1ZXN0LnByb2ZpbGUpIHsKICAgICAgICAgICAgICAgIC8qIEZsYWcgYXMgY29tcGxldGUgYmVjYXVzZSBmaW5pc2hBamF4UmVxdWVzdCBjYW4gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzLiAqLwogICAgICAgICAgICAgICAgcmVxdWVzdC50b29sYmFyUmVwbGFjZUZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIC8qIFNlYXJjaCB1cCB0aHJvdWdoIHRoZSBET00gdG8gZmluZCB0aGUgdG9vbGJhcidzIGNvbnRhaW5lciBJRC4gKi8KICAgICAgICAgICAgICAgIGZvciAodmFyIGVsZW0gPSByZXF1ZXN0LkRPTU5vZGU7IGVsZW0gJiYgZWxlbSAhPT0gZG9jdW1lbnQ7IGVsZW0gPSBlbGVtLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbS5pZC5tYXRjaCgvXnNmd2R0LykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgU2Zqcy5sb2FkVG9vbGJhcihlbGVtLmlkLnJlcGxhY2UoL15zZndkdC8sICcnKSwgcmVxdWVzdC5wcm9maWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwZW5kaW5nUmVxdWVzdHMtLTsKICAgICAgICAgICAgdmFyIHJvdyA9IHJlcXVlc3QuRE9NTm9kZTsKICAgICAgICAgICAgLyogVW5wYWNrIHRoZSBjaGlsZHJlbiBmcm9tIHRoZSByb3cgKi8KICAgICAgICAgICAgdmFyIHByb2ZpbGVyQ2VsbCA9IHJvdy5jaGlsZHJlblsxXTsKICAgICAgICAgICAgdmFyIG1ldGhvZENlbGwgPSByb3cuY2hpbGRyZW5bMl07CiAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlQ2VsbCA9IHJvdy5jaGlsZHJlbls0XTsKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGVFbGVtID0gc3RhdHVzQ29kZUNlbGwuY2hpbGRyZW5bMF07CiAgICAgICAgICAgIHZhciBkdXJhdGlvbkNlbGwgPSByb3cuY2hpbGRyZW5bNl07CgogICAgICAgICAgICBpZiAocmVxdWVzdC5lcnJvcikgewogICAgICAgICAgICAgICAgcm93LmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3Qgc2YtYWpheC1yZXF1ZXN0LWVycm9yJzsKICAgICAgICAgICAgICAgIG1ldGhvZENlbGwuY2xhc3NOYW1lID0gJ3NmLWFqYXgtcmVxdWVzdC1lcnJvcic7CiAgICAgICAgICAgICAgICBzdWNjZXNzU3RyZWFrID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvdy5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0IHNmLWFqYXgtcmVxdWVzdC1vayc7CiAgICAgICAgICAgICAgICBzdWNjZXNzU3RyZWFrKys7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1c0NvZGUpIHsKICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1c0NvZGUgPCAzMDApIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXItc3RhdHVzJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcXVlc3Quc3RhdHVzQ29kZSA8IDQwMCkgewogICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGVFbGVtLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2YtdG9vbGJhci1zdGF0dXMgc2YtdG9vbGJhci1zdGF0dXMteWVsbG93Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGVFbGVtLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2YtdG9vbGJhci1zdGF0dXMgc2YtdG9vbGJhci1zdGF0dXMtcmVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS50ZXh0Q29udGVudCA9IHJlcXVlc3Quc3RhdHVzQ29kZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0YXR1c0NvZGVFbGVtLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2YtdG9vbGJhci1zdGF0dXMgc2YtdG9vbGJhci1zdGF0dXMtcmVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LmR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICBkdXJhdGlvbkNlbGwudGV4dENvbnRlbnQgPSByZXF1ZXN0LmR1cmF0aW9uICsgJyBtcyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnByb2ZpbGVyVXJsKSB7CiAgICAgICAgICAgICAgICBwcm9maWxlckNlbGwudGV4dENvbnRlbnQgPSAnJzsKICAgICAgICAgICAgICAgIHZhciBwcm9maWxlckxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICBwcm9maWxlckxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgcmVxdWVzdC5wcm9maWxlclVybCk7CiAgICAgICAgICAgICAgICBwcm9maWxlckxpbmsudGV4dENvbnRlbnQgPSByZXF1ZXN0LnByb2ZpbGU7CiAgICAgICAgICAgICAgICBwcm9maWxlckNlbGwuYXBwZW5kQ2hpbGQocHJvZmlsZXJMaW5rKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzKCk7CiAgICAgICAgfTsKCiAgICAgICAgIjsKICAgICAgICAvLyBsaW5lIDMxMAogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKCJleGNsdWRlZF9hamF4X3BhdGhzIiwgJGNvbnRleHQpKSB7CiAgICAgICAgICAgIC8vIGxpbmUgMzExCiAgICAgICAgICAgIGVjaG8gIiAgICAgICAgICAgIGlmICh3aW5kb3cuZmV0Y2ggJiYgd2luZG93LmZldGNoLnBvbHlmaWxsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBvbGRGZXRjaCA9IHdpbmRvdy5mZXRjaDsKICAgICAgICAgICAgICAgIHdpbmRvdy5mZXRjaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG9sZEZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGFyZ3VtZW50c1swXTsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzWzFdOwogICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbVR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJndW1lbnRzWzBdKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1UeXBlID09PSAnW29iamVjdCBSZXF1ZXN0XScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gYXJndW1lbnRzWzBdLnVybDsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBhcmd1bWVudHNbMF0ubWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IGFyZ3VtZW50c1swXS5jcmVkZW50aWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGFyZ3VtZW50c1swXS5oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogYXJndW1lbnRzWzBdLm1vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDogYXJndW1lbnRzWzBdLnJlZGlyZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gU3RyaW5nKHVybCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghdXJsLm1hdGNoKG5ldyBSZWdFeHAoIjsKICAgICAgICAgICAgLy8gbGluZSAzMzAKICAgICAgICAgICAgZWNobyBqc29uX2VuY29kZSgoaXNzZXQoJGNvbnRleHRbImV4Y2x1ZGVkX2FqYXhfcGF0aHMiXSkgfHwgYXJyYXlfa2V5X2V4aXN0cygiZXhjbHVkZWRfYWpheF9wYXRocyIsICRjb250ZXh0KSA/ICRjb250ZXh0WyJleGNsdWRlZF9hamF4X3BhdGhzIl0gOiAoZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgUnVudGltZUVycm9yKCdWYXJpYWJsZSAiZXhjbHVkZWRfYWpheF9wYXRocyIgZG9lcyBub3QgZXhpc3QuJywgMzMwLCAkdGhpcy0+c291cmNlKTsgfSkoKSkpOwogICAgICAgICAgICBlY2hvICIpKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gJ0dFVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMgJiYgcGFyYW1zLm1ldGhvZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSBwYXJhbXMubWV0aG9kOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhY2tFbGVtZW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmZXRjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbmV3IERhdGUoKQogICAgICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHJlcXVlc3RTdGFjay5wdXNoKHN0YWNrRWxlbWVudCkgLSAxOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5kdXJhdGlvbiA9IG5ldyBEYXRlKCkgLSBzdGFja0VsZW1lbnQuc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZXJyb3IgPSByLnN0YXR1cyA8IDIwMCB8fCByLnN0YXR1cyA+PSA0MDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuc3RhdHVzQ29kZSA9IHIuc3RhdHVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnByb2ZpbGUgPSByLmhlYWRlcnMuZ2V0KCd4LWRlYnVnLXRva2VuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQucHJvZmlsZXJVcmwgPSByLmhlYWRlcnMuZ2V0KCd4LWRlYnVnLXRva2VuLWxpbmsnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC50b29sYmFyUmVwbGFjZUZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQudG9vbGJhclJlcGxhY2UgPSAnMScgPT09IHIuaGVhZGVycy5nZXQoJ1N5bWZvbnktRGVidWctVG9vbGJhci1SZXBsYWNlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hBamF4UmVxdWVzdChpZHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0QWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0ICYmIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJveGllZCA9IFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuOwoKICAgICAgICAgICAgICAgIFhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwsIGFzeW5jLCB1c2VyLCBwYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgICAgICAgICAvKiBwcmV2ZW50IGxvZ2dpbmcgQUpBWCBjYWxscyB0byBzdGF0aWMgYW5kIGlubGluZSBmaWxlcywgbGlrZSB0ZW1wbGF0ZXMgKi8KICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IHVybDsKICAgICAgICAgICAgICAgICAgICBpZiAodXJsLnNsaWNlKDAsIDEpID09PSAnLycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IHVybC5pbmRleE9mKCciOwogICAgICAgICAgICAvLyBsaW5lIDM3MwogICAgICAgICAgICBlY2hvIHR3aWdfZXNjYXBlX2ZpbHRlcigkdGhpcy0+ZW52LCB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19nZXRfYXR0cmlidXRlKCR0aGlzLT5lbnYsICR0aGlzLT5zb3VyY2UsIChpc3NldCgkY29udGV4dFsicmVxdWVzdCJdKSB8fCBhcnJheV9rZXlfZXhpc3RzKCJyZXF1ZXN0IiwgJGNvbnRleHQpID8gJGNvbnRleHRbInJlcXVlc3QiXSA6IChmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBSdW50aW1lRXJyb3IoJ1ZhcmlhYmxlICJyZXF1ZXN0IiBkb2VzIG5vdCBleGlzdC4nLCAzNzMsICR0aGlzLT5zb3VyY2UpOyB9KSgpKSwgImJhc2VQYXRoIiwgW10sICJhbnkiLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAzNzMpLCAianMiKSwgImh0bWwiLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgZWNobyAiJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSB1cmwuc2xpY2UoIjsKICAgICAgICAgICAgLy8gbGluZSAzNzQKICAgICAgICAgICAgZWNobyB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19sZW5ndGhfZmlsdGVyKCR0aGlzLT5lbnYsIHR3aWdfZ2V0X2F0dHJpYnV0ZSgkdGhpcy0+ZW52LCAkdGhpcy0+c291cmNlLCAoaXNzZXQoJGNvbnRleHRbInJlcXVlc3QiXSkgfHwgYXJyYXlfa2V5X2V4aXN0cygicmVxdWVzdCIsICRjb250ZXh0KSA/ICRjb250ZXh0WyJyZXF1ZXN0Il0gOiAoZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgUnVudGltZUVycm9yKCdWYXJpYWJsZSAicmVxdWVzdCIgZG9lcyBub3QgZXhpc3QuJywgMzc0LCAkdGhpcy0+c291cmNlKTsgfSkoKSksICJiYXNlUGF0aCIsIFtdLCAiYW55IiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMzc0KSksICJodG1sIiwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIGVjaG8gIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoMCA9PT0gdXJsLmluZGV4T2YoJyI7CiAgICAgICAgICAgIC8vIGxpbmUgMzc3CiAgICAgICAgICAgIGVjaG8gdHdpZ19lc2NhcGVfZmlsdGVyKCR0aGlzLT5lbnYsIHR3aWdfZXNjYXBlX2ZpbHRlcigkdGhpcy0+ZW52LCAodHdpZ19nZXRfYXR0cmlidXRlKCR0aGlzLT5lbnYsICR0aGlzLT5zb3VyY2UsIChpc3NldCgkY29udGV4dFsicmVxdWVzdCJdKSB8fCBhcnJheV9rZXlfZXhpc3RzKCJyZXF1ZXN0IiwgJGNvbnRleHQpID8gJGNvbnRleHRbInJlcXVlc3QiXSA6IChmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBSdW50aW1lRXJyb3IoJ1ZhcmlhYmxlICJyZXF1ZXN0IiBkb2VzIG5vdCBleGlzdC4nLCAzNzcsICR0aGlzLT5zb3VyY2UpOyB9KSgpKSwgInNjaGVtZUFuZEh0dHBIb3N0IiwgW10sICJhbnkiLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAzNzcpIC4gdHdpZ19nZXRfYXR0cmlidXRlKCR0aGlzLT5lbnYsICR0aGlzLT5zb3VyY2UsIChpc3NldCgkY29udGV4dFsicmVxdWVzdCJdKSB8fCBhcnJheV9rZXlfZXhpc3RzKCJyZXF1ZXN0IiwgJGNvbnRleHQpID8gJGNvbnRleHRbInJlcXVlc3QiXSA6IChmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBSdW50aW1lRXJyb3IoJ1ZhcmlhYmxlICJyZXF1ZXN0IiBkb2VzIG5vdCBleGlzdC4nLCAzNzcsICR0aGlzLT5zb3VyY2UpOyB9KSgpKSwgImJhc2VQYXRoIiwgW10sICJhbnkiLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAzNzcpKSwgImpzIiksICJodG1sIiwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIGVjaG8gIicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSB1cmwuc2xpY2UoIjsKICAgICAgICAgICAgLy8gbGluZSAzNzgKICAgICAgICAgICAgZWNobyB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgdHdpZ19sZW5ndGhfZmlsdGVyKCR0aGlzLT5lbnYsICh0d2lnX2dldF9hdHRyaWJ1dGUoJHRoaXMtPmVudiwgJHRoaXMtPnNvdXJjZSwgKGlzc2V0KCRjb250ZXh0WyJyZXF1ZXN0Il0pIHx8IGFycmF5X2tleV9leGlzdHMoInJlcXVlc3QiLCAkY29udGV4dCkgPyAkY29udGV4dFsicmVxdWVzdCJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgInJlcXVlc3QiIGRvZXMgbm90IGV4aXN0LicsIDM3OCwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpLCAic2NoZW1lQW5kSHR0cEhvc3QiLCBbXSwgImFueSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDM3OCkgLiB0d2lnX2dldF9hdHRyaWJ1dGUoJHRoaXMtPmVudiwgJHRoaXMtPnNvdXJjZSwgKGlzc2V0KCRjb250ZXh0WyJyZXF1ZXN0Il0pIHx8IGFycmF5X2tleV9leGlzdHMoInJlcXVlc3QiLCAkY29udGV4dCkgPyAkY29udGV4dFsicmVxdWVzdCJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgInJlcXVlc3QiIGRvZXMgbm90IGV4aXN0LicsIDM3OCwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpLCAiYmFzZVBhdGgiLCBbXSwgImFueSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDM3OCkpKSwgImh0bWwiLCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgZWNobyAiKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghcGF0aC5tYXRjaChuZXcgUmVnRXhwKCI7CiAgICAgICAgICAgIC8vIGxpbmUgMzgxCiAgICAgICAgICAgIGVjaG8ganNvbl9lbmNvZGUoKGlzc2V0KCRjb250ZXh0WyJleGNsdWRlZF9hamF4X3BhdGhzIl0pIHx8IGFycmF5X2tleV9leGlzdHMoImV4Y2x1ZGVkX2FqYXhfcGF0aHMiLCAkY29udGV4dCkgPyAkY29udGV4dFsiZXhjbHVkZWRfYWpheF9wYXRocyJdIDogKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignVmFyaWFibGUgImV4Y2x1ZGVkX2FqYXhfcGF0aHMiIGRvZXMgbm90IGV4aXN0LicsIDM4MSwgJHRoaXMtPnNvdXJjZSk7IH0pKCkpKTsKICAgICAgICAgICAgZWNobyAiKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YWNrRWxlbWVudCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAneGhyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gcmVxdWVzdFN0YWNrLnB1c2goc3RhY2tFbGVtZW50KSAtIDE7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnJlYWR5U3RhdGUgPT0gNCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5kdXJhdGlvbiA9IG5ldyBEYXRlKCkgLSBzdGFja0VsZW1lbnQuc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LmVycm9yID0gc2VsZi5zdGF0dXMgPCAyMDAgfHwgc2VsZi5zdGF0dXMgPj0gNDAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5zdGF0dXNDb2RlID0gc2VsZi5zdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdEhlYWRlcnMoc2VsZiwgc3RhY2tFbGVtZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRBamF4UmVxdWVzdChpZHgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcHJveGllZC5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAiOwogICAgICAgIH0KICAgICAgICAvLyBsaW5lIDQxMAogICAgICAgIGVjaG8gIgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGhhc0NsYXNzOiBoYXNDbGFzcywKCiAgICAgICAgICAgIHJlbW92ZUNsYXNzOiByZW1vdmVDbGFzcywKCiAgICAgICAgICAgIGFkZENsYXNzOiBhZGRDbGFzcywKCiAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiB0b2dnbGVDbGFzcywKCiAgICAgICAgICAgIGdldFByZWZlcmVuY2U6IGdldFByZWZlcmVuY2UsCgogICAgICAgICAgICBzZXRQcmVmZXJlbmNlOiBzZXRQcmVmZXJlbmNlLAoKICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogYWRkRXZlbnRMaXN0ZW5lciwKCiAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCgogICAgICAgICAgICByZW5kZXJBamF4UmVxdWVzdHM6IHJlbmRlckFqYXhSZXF1ZXN0cywKCiAgICAgICAgICAgIGdldFNmd2R0OiBmdW5jdGlvbih0b2tlbikgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNmd2R0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZndkdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZndkdCcgKyB0b2tlbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2Z3ZHQ7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBsb2FkOiBmdW5jdGlvbihzZWxlY3RvciwgdXJsLCBvblN1Y2Nlc3MsIG9uRXJyb3IsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdG9yKTsKCiAgICAgICAgICAgICAgICBpZiAoZWwgJiYgZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXNmdXJsJykgIT09IHVybCkgewogICAgICAgICAgICAgICAgICAgIHJlcXVlc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oeGhyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5pbm5lckhUTUwgPSB4aHIucmVzcG9uc2VUZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdkYXRhLXNmdXJsJywgdXJsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGVsLCAnbG9hZGluZycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBlbmRpbmcgPSBwZW5kaW5nUmVxdWVzdHM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlcXVlc3RTdGFjay5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0QWpheFJlcXVlc3QoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVlc3RTdGFja1tpXS5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hBamF4UmVxdWVzdChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBSZXZlcnQgdGhlIHBlbmRpbmcgc3RhdGUgaW4gY2FzZSB0aGVyZSB3YXMgYSBzdGFydCBjYWxsZWQgd2l0aG91dCBhIGZpbmlzaCBhYm92ZS4gKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cyA9IHBlbmRpbmc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAob25TdWNjZXNzIHx8IG5vb3ApKHhociwgZWwpOwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih4aHIpIHsgKG9uRXJyb3IgfHwgbm9vcCkoeGhyLCBlbCk7IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICcnLAogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dUb29sYmFyOiBmdW5jdGlvbih0b2tlbikgewogICAgICAgICAgICAgICAgdmFyIHNmd2R0ID0gdGhpcy5nZXRTZndkdCh0b2tlbik7CiAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhzZndkdCwgJ3NmLWRpc3BsYXktbm9uZScpOwoKICAgICAgICAgICAgICAgIGlmIChnZXRQcmVmZXJlbmNlKCd0b29sYmFyL2Rpc3BsYXlTdGF0ZScpID09ICdub25lJykgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJNYWluQ29udGVudC0nICsgdG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmVG9vbGJhckNsZWFyZXItJyArIHRva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZk1pbmlUb29sYmFyLScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJNYWluQ29udGVudC0nICsgdG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmTWluaVRvb2xiYXItJyArIHRva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGlkZVRvb2xiYXI6IGZ1bmN0aW9uKHRva2VuKSB7CiAgICAgICAgICAgICAgICB2YXIgc2Z3ZHQgPSB0aGlzLmdldFNmd2R0KHRva2VuKTsKICAgICAgICAgICAgICAgIGFkZENsYXNzKHNmd2R0LCAnc2YtZGlzcGxheS1ub25lJyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0VG9vbGJhcjogZnVuY3Rpb24odG9rZW4pIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd1Rvb2xiYXIodG9rZW4pOwoKICAgICAgICAgICAgICAgIHZhciBoaWRlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmVG9vbGJhckhpZGVCdXR0b24tJyArIHRva2VuKTsKICAgICAgICAgICAgICAgIHZhciBoaWRlQnV0dG9uU3ZnID0gaGlkZUJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzdmcnKTsKICAgICAgICAgICAgICAgIGhpZGVCdXR0b25Tdmcuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7CiAgICAgICAgICAgICAgICBoaWRlQnV0dG9uU3ZnLnNldEF0dHJpYnV0ZSgnZm9jdXNhYmxlJywgJ2ZhbHNlJyk7CiAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGhpZGVCdXR0b24sICdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgICAgIHZhciBwID0gdGhpcy5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIHAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAocC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nIHx8IHAucHJldmlvdXNTaWJsaW5nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZk1pbmlUb29sYmFyLScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgc2V0UHJlZmVyZW5jZSgndG9vbGJhci9kaXNwbGF5U3RhdGUnLCAnbm9uZScpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHNob3dCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWluaVRvZ2dsZXItJyArIHRva2VuKTsKICAgICAgICAgICAgICAgIHZhciBzaG93QnV0dG9uU3ZnID0gc2hvd0J1dHRvbi5xdWVyeVNlbGVjdG9yKCdzdmcnKTsKICAgICAgICAgICAgICAgIHNob3dCdXR0b25Tdmcuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7CiAgICAgICAgICAgICAgICBzaG93QnV0dG9uU3ZnLnNldEF0dHJpYnV0ZSgnZm9jdXNhYmxlJywgJ2ZhbHNlJyk7CiAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKHNob3dCdXR0b24sICdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgICAgIHZhciBlbGVtID0gdGhpcy5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtLnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJNYWluQ29udGVudC0nICsgdG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIHRva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmVG9vbGJhckNsZWFyZXItJyArIHRva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzZXRQcmVmZXJlbmNlKCd0b29sYmFyL2Rpc3BsYXlTdGF0ZScsICdibG9jaycpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBsb2FkVG9vbGJhcjogZnVuY3Rpb24odG9rZW4sIG5ld1Rva2VuKSB7CiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgdHJpZXNDb3VudGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmTG9hZENvdW50ZXItJyArIHRva2VuKTsKCiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICByZXRyeTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBvblNlbmQ6IGZ1bmN0aW9uIChjb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaW5pdFRvb2xiYXIodG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJpZXNDb3VudGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmllc0NvdW50ZXIudGV4dENvbnRlbnQgPSBjb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHZhciBjYW5jZWxCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZMb2FkQ2FuY2VsLScgKyB0b2tlbik7CiAgICAgICAgICAgICAgICBpZiAoY2FuY2VsQnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihjYW5jZWxCdXR0b24sICdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdG9wID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5oaWRlVG9vbGJhcih0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbmV3VG9rZW4gPSAobmV3VG9rZW4gfHwgdG9rZW4pOwoKICAgICAgICAgICAgICAgIHRoaXMubG9hZCgKICAgICAgICAgICAgICAgICAgICAnc2Z3ZHQnICsgdG9rZW4sCiAgICAgICAgICAgICAgICAgICAgJyI7CiAgICAgICAgLy8gbGluZSA1NTgKICAgICAgICBlY2hvIHR3aWdfZXNjYXBlX2ZpbHRlcigkdGhpcy0+ZW52LCB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgJHRoaXMtPmV4dGVuc2lvbnNbJ1N5bWZvbnlcQnJpZGdlXFR3aWdcRXh0ZW5zaW9uXFJvdXRpbmdFeHRlbnNpb24nXS0+Z2V0VXJsKCJfd2R0IiwgWyJ0b2tlbiIgPT4gInh4eHh4eCJdKSwgImpzIiksICJodG1sIiwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgZWNobyAiJy5yZXBsYWNlKC94eHh4eHgvLCBuZXdUb2tlbiksCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oeGhyLCBlbCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKiBEbyBub3RoaW5nIGluIHRoZSBlZGdlIGNhc2Ugd2hlcmUgdGhlIHRvb2xiYXIgaGFzIGFscmVhZHkgYmVlbiByZXBsYWNlZCB3aXRoIGEgbmV3IG9uZSAqLwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJNYWluQ29udGVudC0nICsgbmV3VG9rZW4pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIEV2YWx1YXRlIGluIGdsb2JhbCBzY29wZSBzY3JpcHRzIGVtYmVkZGVkIGluc2lkZSB0aGUgdG9vbGJhciAqLwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSwgc2NyaXB0cyA9IFtdLnNsaWNlLmNhbGwoZWwucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0JykpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbC5jYWxsKHt9LCBzY3JpcHRzW2ldLmZpcnN0Q2hpbGQubm9kZVZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9IC0xICE9PSB4aHIucmVzcG9uc2VUZXh0LmluZGV4T2YoJ3NmLXRvb2xiYXJyZXNldCcpID8gJ2Jsb2NrJyA6ICdub25lJzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbC5zdHlsZS5kaXNwbGF5ID09ICdub25lJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmluaXRUb29sYmFyKG5ld1Rva2VuKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIEhhbmRsZSB0b29sYmFyLWluZm8gcG9zaXRpb24gKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvb2xiYXJCbG9ja3MgPSBbXS5zbGljZS5jYWxsKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b29sYmFyLWJsb2NrJykpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9vbGJhckJsb2Nrcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckJsb2Nrc1tpXS5vbm1vdXNlb3ZlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbGJhckluZm8gPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b29sYmFyLWluZm8nKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZVdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudFdpZHRoID0gdG9vbGJhckluZm8ub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnRWYWx1ZSA9IChlbGVtZW50V2lkdGggKyB0aGlzLm9mZnNldExlZnQpIC0gcGFnZVdpZHRoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByaWdodFZhbHVlID0gKGVsZW1lbnRXaWR0aCArIChwYWdlV2lkdGggLSB0aGlzLm9mZnNldExlZnQpKSAtIHBhZ2VXaWR0aDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogUmVzZXQgcmlnaHQgYW5kIGxlZnQgdmFsdWUsIHVzZWZ1bCBvbiB3aW5kb3cgcmVzaXplICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUucmlnaHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFySW5mby5zdHlsZS5sZWZ0ID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50V2lkdGggPiBwYWdlV2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUubGVmdCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxlZnRWYWx1ZSA+IDAgJiYgcmlnaHRWYWx1ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUucmlnaHQgPSAocmlnaHRWYWx1ZSAqIC0xKSArICdweCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsZWZ0VmFsdWUgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLmxlZnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLnJpZ2h0ID0gJzBweCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYWpheC1jbGVhcicpLCAnY2xpY2snLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RTdGFjayA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzU3RyZWFrID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtcmVxdWVzdC1saXN0JykuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWJsb2NrLWFqYXgnKSwgJ21vdXNlZW50ZXInLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stYWpheCAuc2YtdG9vbGJhci1pbmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnNjcm9sbFRvcCA9IGVsZW0uc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1ibG9jay1hamF4ID4gLnNmLXRvb2xiYXItaWNvbicpLCAnY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5wYXJlbnROb2RlLCAnaG92ZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHVtcEluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1ibG9jay1kdW1wIC5zZi10b29sYmFyLWluZm8nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IGR1bXBJbmZvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGR1bXBJbmZvLCAnc2ZiZWZvcmVkdW1wY29sbGFwc2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVtcEluZm8uc3R5bGUubWluSGVpZ2h0ID0gZHVtcEluZm8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0KydweCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoZHVtcEluZm8sICdtb3VzZWxlYXZlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBJbmZvLnN0eWxlLm1pbkhlaWdodCA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyAhPT0gMCAmJiAhb3B0aW9ucy5zdG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2Z3ZHQgPSB0aGF0LmdldFNmd2R0KHRva2VuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNmd2R0LmlubmVySFRNTCA9ICdcXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzZi10b29sYmFycmVzZXQgbm90cmFuc2xhdGVcIj5cXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2YtdG9vbGJhci1pY29uXCI+PHN2ZyB3aWR0aD1cIjI2XCIgaGVpZ2h0PVwiMjhcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgdmVyc2lvbj1cIjEuMVwiIHg9XCIwcHhcIiB5PVwiMHB4XCIgdmlld0JveD1cIjAgMCAyNiAyOFwiIGVuYWJsZS1iYWNrZ3JvdW5kPVwibmV3IDAgMCAyNiAyOFwiIHhtbDpzcGFjZT1cInByZXNlcnZlXCI+PHBhdGggZmlsbD1cIiNGRkZGRkZcIiBkPVwiTTEzIDBDNS44IDAgMCA1LjggMCAxM2MwIDcuMiA1LjggMTMgMTMgMTNjNy4yIDAgMTMtNS44IDEzLTEzQzI2IDUuOCAyMC4yIDAgMTMgMHogTTIwIDcuNSBjLTAuNiAwLTEtMC4zLTEtMC45YzAtMC4yIDAtMC40IDAuMi0wLjZjMC4xLTAuMyAwLjItMC4zIDAuMi0wLjRjMC0wLjMtMC41LTAuNC0wLjctMC40Yy0yIDAuMS0yLjUgMi43LTIuOSA0LjhsLTAuMiAxLjEgYzEuMSAwLjIgMS45IDAgMi40LTAuM2MwLjYtMC40LTAuMi0wLjgtMC4xLTEuM0MxOCA5LjIgMTguNCA5IDE4LjcgOC45YzAuNSAwIDAuOCAwLjUgMC44IDFjMCAwLjgtMS4xIDItMy4zIDEuOSBjLTAuMyAwLTAuNSAwLTAuNy0wLjFMMTUgMTQuMWMtMC40IDEuNy0wLjkgNC4xLTIuNiA2LjJjLTEuNSAxLjgtMy4xIDIuMS0zLjggMi4xYy0xLjMgMC0yLjEtMC42LTIuMi0xLjZjMC0wLjkgMC44LTEuNCAxLjMtMS40IGMwLjcgMCAxLjIgMC41IDEuMiAxLjFjMCAwLjUtMC4yIDAuNi0wLjQgMC43Yy0wLjEgMC4xLTAuMyAwLjItMC4zIDAuNGMwIDAuMSAwLjEgMC4zIDAuNCAwLjNjMC41IDAgMC45LTAuMyAxLjItMC41IGMxLjMtMSAxLjctMi45IDIuNC02LjJsMC4xLTAuOGMwLjItMS4xIDAuNS0yLjMgMC44LTMuNWMtMC45LTAuNy0xLjQtMS41LTIuNi0xLjhjLTAuOC0wLjItMS4zIDAtMS43IDAuNEM4LjQgMTAgOC42IDEwLjcgOSAxMS4xIGwwLjcgMC43YzAuOCAwLjkgMS4zIDEuNyAxLjEgMi43Yy0wLjMgMS42LTIuMSAyLjgtNC4zIDIuMWMtMS45LTAuNi0yLjItMS45LTItMi43YzAuMi0wLjYgMC43LTAuOCAxLjItMC42IGMwLjUgMC4yIDAuNyAwLjggMC42IDEuM2MwIDAuMSAwIDAuMS0wLjEgMC4zQzYgMTUgNS45IDE1LjIgNS45IDE1LjNjLTAuMSAwLjQgMC40IDAuNyAwLjggMC44YzAuOCAwLjMgMS43LTAuMiAxLjktMC45IGMwLjItMC42LTAuMi0xLjEtMC40LTEuMmwtMC44LTAuOWMtMC40LTAuNC0xLjItMS41LTAuOC0yLjhjMC4yLTAuNSAwLjUtMSAwLjktMS40YzEtMC43IDItMC44IDMtMC42YzEuMyAwLjQgMS45IDEuMiAyLjggMS45IGMwLjUtMS4zIDEuMS0yLjYgMi0zLjhjMC45LTEgMi0xLjcgMy4zLTEuOEMyMCA0LjggMjEgNS40IDIxIDYuM0MyMSA2LjcgMjAuOCA3LjUgMjAgNy41elwiLz48L3N2Zz48L2Rpdj5cXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBsb2FkaW5nIHRoZSB3ZWIgZGVidWcgdG9vbGJhci4gPGEgaHJlZj1cIiI7CiAgICAgICAgLy8gbGluZSA2MzkKICAgICAgICBlY2hvIHR3aWdfZXNjYXBlX2ZpbHRlcigkdGhpcy0+ZW52LCB0d2lnX2VzY2FwZV9maWx0ZXIoJHRoaXMtPmVudiwgJHRoaXMtPmV4dGVuc2lvbnNbJ1N5bWZvbnlcQnJpZGdlXFR3aWdcRXh0ZW5zaW9uXFJvdXRpbmdFeHRlbnNpb24nXS0+Z2V0VXJsKCJfcHJvZmlsZXJfaG9tZSIpLCAianMiKSwgImh0bWwiLCBudWxsLCB0cnVlKTsKICAgICAgICBlY2hvICInICsgbmV3VG9rZW4gKyAnPk9wZW4gdGhlIHdlYiBwcm9maWxlci48L2E+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNmd2R0LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2YtdG9vbGJhciBzZi1lcnJvci10b29sYmFyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKHNlbGVjdG9yLCBlbE9uLCBlbE9mZikgewogICAgICAgICAgICAgICAgdmFyIHRtcCA9IGVsT24uc3R5bGUuZGlzcGxheSwKICAgICAgICAgICAgICAgICAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdG9yKTsKCiAgICAgICAgICAgICAgICBlbE9uLnN0eWxlLmRpc3BsYXkgPSBlbE9mZi5zdHlsZS5kaXNwbGF5OwogICAgICAgICAgICAgICAgZWxPZmYuc3R5bGUuZGlzcGxheSA9IHRtcDsKCiAgICAgICAgICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnID09PSB0bXAgPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlVGFiczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdGFiR3JvdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNmLXRhYnM6bm90KFtkYXRhLXByb2Nlc3NlZD10cnVlXSknKTsKCiAgICAgICAgICAgICAgICAvKiBjcmVhdGUgdGhlIHRhYiBuYXZpZ2F0aW9uIGZvciBlYWNoIGdyb3VwIG9mIHRhYnMgKi8KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFiR3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRhYnMgPSB0YWJHcm91cHNbaV0ucXVlcnlTZWxlY3RvckFsbCgnOnNjb3BlID4gLnRhYicpOwogICAgICAgICAgICAgICAgICAgIHZhciB0YWJOYXZpZ2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsKICAgICAgICAgICAgICAgICAgICB0YWJOYXZpZ2F0aW9uLmNsYXNzTmFtZSA9ICd0YWItbmF2aWdhdGlvbic7CgogICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFRhYklkID0gJ3RhYi0nICsgaSArICctMCc7IC8qIHNlbGVjdCB0aGUgZmlyc3QgdGFiIGJ5IGRlZmF1bHQgKi8KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYklkID0gJ3RhYi0nICsgaSArICctJyArIGo7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJUaXRsZSA9IHRhYnNbal0ucXVlcnlTZWxlY3RvcignLnRhYi10aXRsZScpLmlubmVySFRNTDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJOYXZpZ2F0aW9uSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb25JdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS10YWItaWQnLCB0YWJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNDbGFzcyh0YWJzW2pdLCAnYWN0aXZlJykpIHsgc2VsZWN0ZWRUYWJJZCA9IHRhYklkOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNDbGFzcyh0YWJzW2pdLCAnZGlzYWJsZWQnKSkgeyBhZGRDbGFzcyh0YWJOYXZpZ2F0aW9uSXRlbSwgJ2Rpc2FibGVkJyk7IH0KICAgICAgICAgICAgICAgICAgICAgICAgdGFiTmF2aWdhdGlvbkl0ZW0uaW5uZXJIVE1MID0gdGFiVGl0bGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb24uYXBwZW5kQ2hpbGQodGFiTmF2aWdhdGlvbkl0ZW0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYkNvbnRlbnQgPSB0YWJzW2pdLnF1ZXJ5U2VsZWN0b3IoJy50YWItY29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0YWJDb250ZW50LnBhcmVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIHRhYklkKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRhYkdyb3Vwc1tpXS5pbnNlcnRCZWZvcmUodGFiTmF2aWdhdGlvbiwgdGFiR3JvdXBzW2ldLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXRhYi1pZD1cIicgKyBzZWxlY3RlZFRhYklkICsgJ1wiXScpLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLyogZGlzcGxheSB0aGUgYWN0aXZlIHRhYiBhbmQgYWRkIHRoZSAnY2xpY2snIGV2ZW50IGxpc3RlbmVycyAqLwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRhYkdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb24gPSB0YWJHcm91cHNbaV0ucXVlcnlTZWxlY3RvckFsbCgnOnNjb3BlID4gLnRhYi1uYXZpZ2F0aW9uIGxpJyk7CgogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB0YWJOYXZpZ2F0aW9uLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYklkID0gdGFiTmF2aWdhdGlvbltqXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFiLWlkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5xdWVyeVNlbGVjdG9yKCcudGFiLXRpdGxlJykuY2xhc3NOYW1lID0gJ2hpZGRlbic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ2xhc3ModGFiTmF2aWdhdGlvbltqXSwgJ2FjdGl2ZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJJZCkuY2xhc3NOYW1lID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5jbGFzc05hbWUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFiTmF2aWdhdGlvbltqXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3RpdmVUYWIgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbmVlZGVkIGJlY2F1c2Ugd2hlbiB0aGUgdGFiIGNvbnRhaW5zIEhUTUwgY29udGVudHMsIHVzZXIgY2FuIGNsaWNrICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBvbiBhbnkgb2YgdGhvc2UgZWxlbWVudHMgaW5zdGVhZCBvZiB0aGVpciBwYXJlbnQgJzxsaT4nIGVsZW1lbnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChhY3RpdmVUYWIudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnbGknKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlVGFiID0gYWN0aXZlVGFiLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZ2V0IHRoZSBmdWxsIGxpc3Qgb2YgdGFicyB0aHJvdWdoIHRoZSBwYXJlbnQgb2YgdGhlIGFjdGl2ZSB0YWIgZWxlbWVudCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYk5hdmlnYXRpb24gPSBhY3RpdmVUYWIucGFyZW50Tm9kZS5jaGlsZHJlbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGFiTmF2aWdhdGlvbi5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJJZCA9IHRhYk5hdmlnYXRpb25ba10uZ2V0QXR0cmlidXRlKCdkYXRhLXRhYi1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5jbGFzc05hbWUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyh0YWJOYXZpZ2F0aW9uW2tdLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3MoYWN0aXZlVGFiLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlVGFiSWQgPSBhY3RpdmVUYWIuZ2V0QXR0cmlidXRlKCdkYXRhLXRhYi1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYWN0aXZlVGFiSWQpLmNsYXNzTmFtZSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGFiR3JvdXBzW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9jZXNzZWQnLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlVG9nZ2xlczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdG9nZ2xlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b2dnbGU6bm90KFtkYXRhLXByb2Nlc3NlZD10cnVlXSknKTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvZ2dsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudFNlbGVjdG9yID0gdG9nZ2xlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLXNlbGVjdG9yJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnRTZWxlY3Rvcik7CgogICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtY29udGVudCcpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodG9nZ2xlc1tpXS5oYXNBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWluaXRpYWwnKSAmJiB0b2dnbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUtaW5pdGlhbCcpID09ICdkaXNwbGF5JykgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyh0b2dnbGVzW2ldLCAnc2YtdG9nZ2xlLW9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtdmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKHRvZ2dsZXNbaV0sICdzZi10b2dnbGUtb2ZmJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKHRvZ2dsZXNbaV0sICdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCcnICE9PSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogRG9uJ3QgZG8gYW55dGhpbmcgb24gdGV4dCBzZWxlY3Rpb24gKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvZ2dsZSA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIG5lZWRlZCBiZWNhdXNlIHdoZW4gdGhlIHRvZ2dsZSBjb250YWlucyBIVE1MIGNvbnRlbnRzLCB1c2VyIGNhbiBjbGljayAqLwogICAgICAgICAgICAgICAgICAgICAgICAvKiBvbiBhbnkgb2YgdGhvc2UgZWxlbWVudHMgaW5zdGVhZCBvZiB0aGVpciBwYXJlbnQgJy5zZi10b2dnbGUnIGVsZW1lbnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFoYXNDbGFzcyh0b2dnbGUsICdzZi10b2dnbGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlID0gdG9nZ2xlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0b2dnbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1zZWxlY3RvcicpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHRvZ2dsZSwgJ3NmLXRvZ2dsZS1vbicpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyh0b2dnbGUsICdzZi10b2dnbGUtb2ZmJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtdmlzaWJsZScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLyogdGhlIHRvZ2dsZSBkb2Vzbid0IGNoYW5nZSBpdHMgY29udGVudHMgd2hlbiBjbGlja2luZyBvbiBpdCAqLwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRvZ2dsZS5oYXNBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWFsdC1jb250ZW50JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2dnbGUuaGFzQXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1vcmlnaW5hbC1jb250ZW50JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLW9yaWdpbmFsLWNvbnRlbnQnLCB0b2dnbGUuaW5uZXJIVE1MKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDb250ZW50ID0gdG9nZ2xlLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdpbmFsQ29udGVudCA9IHRvZ2dsZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLW9yaWdpbmFsLWNvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsdENvbnRlbnQgPSB0b2dnbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1hbHQtY29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGUuaW5uZXJIVE1MID0gY3VycmVudENvbnRlbnQgIT09IGFsdENvbnRlbnQgPyBhbHRDb250ZW50IDogb3JpZ2luYWxDb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvKiBQcmV2ZW50cyBmcm9tIGRpc2FsbG93aW5nIGNsaWNrcyBvbiBsaW5rcyBpbnNpZGUgdG9nZ2xlcyAqLwogICAgICAgICAgICAgICAgICAgIHZhciB0b2dnbGVMaW5rcyA9IHRvZ2dsZXNbaV0ucXVlcnlTZWxlY3RvckFsbCgnYScpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdG9nZ2xlTGlua3MubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcih0b2dnbGVMaW5rc1tqXSwgJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvKiBQcmV2ZW50cyBmcm9tIGRpc2FsbG93aW5nIGNsaWNrcyBvbiBcImNvcHkgdG8gY2xpcGJvYXJkXCIgZWxlbWVudHMgaW5zaWRlIHRvZ2dsZXMgKi8KICAgICAgICAgICAgICAgICAgICB2YXIgY29weVRvQ2xpcGJvYXJkRWxlbWVudHMgPSB0b2dnbGVzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NwYW5bZGF0YS1jbGlwYm9hcmQtdGV4dF0nKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGNvcHlUb0NsaXBib2FyZEVsZW1lbnRzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoY29weVRvQ2xpcGJvYXJkRWxlbWVudHNba10sICdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlc1tpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvY2Vzc2VkJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemVMb2dzVGFibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgU2Zqcy51cGRhdGVMb2dzVGFibGUoKTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubG9nLWZpbHRlciBpbnB1dCcpLmZvckVhY2goKGlucHV0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4geyBTZmpzLnVwZGF0ZUxvZ3NUYWJsZSgpOyB9KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItc2VsZWN0LWFsbC1vci1ub25lIGJ1dHRvbicpLmZvckVhY2goKGxpbmspID0+IHsKICAgICAgICAgICAgICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RBbGwgPSBsaW5rLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0LWFsbCcpOwogICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmNsb3Nlc3QoJy5sb2ctZmlsdGVyLWNvbnRlbnQnKS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCcpLmZvckVhY2goKGlucHV0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gc2VsZWN0QWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIFNmanMudXBkYXRlTG9nc1RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGV0YWlscy5sb2ctZmlsdGVyJykuZm9yRWFjaCgoZmlsdGVyRWxlbWVudCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbHRlckVsZW1lbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSAmJiBmaWx0ZXJFbGVtZW50Lm9wZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckVsZW1lbnQub3BlbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemVNYWlsZXJUYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlbWFpbFJvd3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWFpbGVyLWVtYWlsLXN1bW1hcnktdGFibGUtcm93Jyk7CgogICAgICAgICAgICAgICAgZW1haWxSb3dzLmZvckVhY2goKGVtYWlsUm93KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZW1haWxSb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsUm93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxSb3dzLmZvckVhY2goKHJvdykgPT4gcm93LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsUm93LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tYWlsZXItZW1haWwtZGV0YWlscycpLmZvckVhY2goKGVtYWlsRGV0YWlscykgPT4gZW1haWxEZXRhaWxzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbWFpbFJvdy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFyZ2V0JykpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlTG9nc1RhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVHlwZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsb2ctZmlsdGVyLXR5cGUgaW5wdXQ6Y2hlY2tlZCcpLnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3QgcHJpb3JpdGllcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNsb2ctZmlsdGVyLXByaW9yaXR5IGlucHV0Jyk7CiAgICAgICAgICAgICAgICBjb25zdCBhbGxQcmlvcml0aWVzID0gQXJyYXkuZnJvbShwcmlvcml0aWVzKS5tYXAoKGlucHV0KSA9PiBpbnB1dC52YWx1ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFByaW9yaXRpZXMgPSBBcnJheS5mcm9tKHByaW9yaXRpZXMpLmZpbHRlcigoaW5wdXQpID0+IGlucHV0LmNoZWNrZWQpLm1hcCgoaW5wdXQpID0+IGlucHV0LnZhbHVlKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNoYW5uZWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2xvZy1maWx0ZXItY2hhbm5lbCBpbnB1dCcpOwogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRDaGFubmVscyA9IEFycmF5LmZyb20oY2hhbm5lbHMpLmZpbHRlcigoaW5wdXQpID0+IGlucHV0LmNoZWNrZWQpLm1hcCgoaW5wdXQpID0+IGlucHV0LnZhbHVlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBsb2dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGFibGUubG9ncycpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IGxvZ3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLyogaGlkZSByb3dzIHRoYXQgZG9uJ3QgbWF0Y2ggdGhlIGN1cnJlbnQgZmlsdGVycyAqLwogICAgICAgICAgICAgICAgbGV0IG51bVZpc2libGVSb3dzID0gMDsKICAgICAgICAgICAgICAgIGxvZ3MucXVlcnlTZWxlY3RvckFsbCgndGJvZHkgdHInKS5mb3JFYWNoKChyb3cpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoJ2FsbCcgIT09IHNlbGVjdGVkVHlwZSAmJiBzZWxlY3RlZFR5cGUgIT09IHJvdy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHlwZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmlvcml0eSA9IHJvdy5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJpb3JpdHknKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmFsc2UgPT09IHNlbGVjdGVkUHJpb3JpdGllcy5pbmNsdWRlcyhwcmlvcml0eSkgJiYgdHJ1ZSA9PT0gYWxsUHJpb3JpdGllcy5pbmNsdWRlcyhwcmlvcml0eSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcm93LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgnJyAhPT0gcm93LmdldEF0dHJpYnV0ZSgnZGF0YS1jaGFubmVsJykgJiYgZmFsc2UgPT09IHNlbGVjdGVkQ2hhbm5lbHMuaW5jbHVkZXMocm93LmdldEF0dHJpYnV0ZSgnZGF0YS1jaGFubmVsJykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByb3cuc3R5bGUuZGlzcGxheSA9ICd0YWJsZS1yb3cnOwogICAgICAgICAgICAgICAgICAgIG51bVZpc2libGVSb3dzKys7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0YWJsZS5sb2dzJykuc3R5bGUuZGlzcGxheSA9IDAgPT09IG51bVZpc2libGVSb3dzID8gJ25vbmUnIDogJ3RhYmxlJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uby1sb2dzLW1lc3NhZ2UnKS5zdHlsZS5kaXNwbGF5ID0gMCA9PT0gbnVtVmlzaWJsZVJvd3MgPyAnYmxvY2snIDogJ25vbmUnOwoKICAgICAgICAgICAgICAgIC8qIHVwZGF0ZSB0aGUgc2VsZWN0ZWQgdG90YWxzIG9mIGFsbCBmaWx0ZXJzICovCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbG9nLWZpbHRlci1wcmlvcml0eSAuZmlsdGVyLWFjdGl2ZS1udW0nKS5pbm5lclRleHQgPSAocHJpb3JpdGllcy5sZW5ndGggPT09IHNlbGVjdGVkUHJpb3JpdGllcy5sZW5ndGgpID8gJ0FsbCcgOiBzZWxlY3RlZFByaW9yaXRpZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvZy1maWx0ZXItY2hhbm5lbCAuZmlsdGVyLWFjdGl2ZS1udW0nKS5pbm5lclRleHQgPSAoY2hhbm5lbHMubGVuZ3RoID09PSBzZWxlY3RlZENoYW5uZWxzLmxlbmd0aCkgPyAnQWxsJyA6IHNlbGVjdGVkQ2hhbm5lbHMubGVuZ3RoOwoKICAgICAgICAgICAgICAgIC8qIHVwZGF0ZSB0aGUgY3VycmVudGx5IHNlbGVjdGVkIFwibG9nIHR5cGVcIiB0YWIgKi8KICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNsb2ctZmlsdGVyLXR5cGUgbGknKS5mb3JFYWNoKCh0YWIpID0+IHRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjbG9nLWZpbHRlci10eXBlIGlucHV0W3ZhbHVlPVwiXCR7c2VsZWN0ZWRUeXBlfVwiXWApLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgIH0pKCk7CgogICAgU2Zqcy5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCAnRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIFNmanMuY3JlYXRlVGFicygpOwogICAgICAgIFNmanMuY3JlYXRlVG9nZ2xlcygpOwogICAgfSk7Cn0KLypdXT4qLzwvc2NyaXB0PgoiOwogICAgICAgIAogICAgICAgICRfX2ludGVybmFsXzVhMjdhOGJhMjFjYTc5YjYxOTMyMzc2YjJmYTkyMmQyLT5sZWF2ZSgkX19pbnRlcm5hbF81YTI3YThiYTIxY2E3OWI2MTkzMjM3NmIyZmE5MjJkMl9wcm9mKTsKCiAgICAgICAgCiAgICAgICAgJF9faW50ZXJuYWxfNmY0N2JiZTk5ODNhZjgxZjFlNzQ1MGU5YTNlMzc2OGYtPmxlYXZlKCRfX2ludGVybmFsXzZmNDdiYmU5OTgzYWY4MWYxZTc0NTBlOWEzZTM3NjhmX3Byb2YpOwoKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VGVtcGxhdGVOYW1lKCkKICAgIHsKICAgICAgICByZXR1cm4gIkBXZWJQcm9maWxlci9Qcm9maWxlci9iYXNlX2pzLmh0bWwudHdpZyI7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGlzVHJhaXRhYmxlKCkKICAgIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldERlYnVnSW5mbygpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5ICggIDcxMiA9PiA2MzksICA2MjggPT4gNTU4LCAgNDc4ID0+IDQxMCwgIDQ0NiA9PiAzODEsICA0NDAgPT4gMzc4LCAgNDM2ID0+IDM3NywgIDQzMCA9PiAzNzQsICA0MjYgPT4gMzczLCAgMzgwID0+IDMzMCwgIDM1OSA9PiAzMTEsICAzNTcgPT4gMzEwLCAgNTIgPT4gNywgIDQzID0+IDMsKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U291cmNlQ29udGV4dCgpCiAgICB7CiAgICAgICAgcmV0dXJuIG5ldyBTb3VyY2UoInsjIFRoaXMgZmlsZSBpcyBwYXJ0aWFsbHkgZHVwbGljYXRlZCBpbiBzcmMvU3ltZm9ueS9Db21wb25lbnQvRXJyb3JIYW5kbGVyL1Jlc291cmNlcy9hc3NldHMvanMvZXhjZXB0aW9uLmpzLgogICBJZiB5b3UgbWFrZSBhbnkgY2hhbmdlIGluIHRoaXMgZmlsZSwgdmVyaWZ5IHRoZSBzYW1lIGNoYW5nZSBpcyBuZWVkZWQgaW4gdGhlIG90aGVyIGZpbGUuICN9CjxzY3JpcHR7JSBpZiBjc3Bfc2NyaXB0X25vbmNlIGlzIGRlZmluZWQgYW5kIGNzcF9zY3JpcHRfbm9uY2UgJX0gbm9uY2U9XCJ7eyBjc3Bfc2NyaXB0X25vbmNlIH19XCJ7JSBlbmRpZiAlfT4vKjwhW0NEQVRBWyovCiAgICB7IyBDYXV0aW9uOiB0aGUgY29udGVudHMgb2YgdGhpcyBmaWxlIGFyZSBwcm9jZXNzZWQgYnkgVHdpZyBiZWZvcmUgbG9hZGluZwogICAgICAgICAgICAgICAgdGhlbSBhcyBKYXZhU2NyaXB0IHNvdXJjZSBjb2RlLiBBbHdheXMgdXNlICcvKicgY29tbWVudHMgaW5zdGVhZAogICAgICAgICAgICAgICAgb2YgJy8vJyBjb21tZW50cyB0byBhdm9pZCBpbXBvc3NpYmxlLXRvLWRlYnVnIHNpZGUtZWZmZWN0cyAjfQoKaWYgKHR5cGVvZiBTZmpzID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgU2Zqcy5sb2FkVG9vbGJhciA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIFNmanMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7CgogICAgICAgIGlmICgnY2xhc3NMaXN0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIGhhc0NsYXNzID0gZnVuY3Rpb24gKGVsLCBjc3NDbGFzcykgeyByZXR1cm4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNzc0NsYXNzKTsgfTsKICAgICAgICAgICAgdmFyIHJlbW92ZUNsYXNzID0gZnVuY3Rpb24oZWwsIGNzc0NsYXNzKSB7IGVsLmNsYXNzTGlzdC5yZW1vdmUoY3NzQ2xhc3MpOyB9OwogICAgICAgICAgICB2YXIgYWRkQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgZWwuY2xhc3NMaXN0LmFkZChjc3NDbGFzcyk7IH07CiAgICAgICAgICAgIHZhciB0b2dnbGVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBlbC5jbGFzc0xpc3QudG9nZ2xlKGNzc0NsYXNzKTsgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgaGFzQ2xhc3MgPSBmdW5jdGlvbiAoZWwsIGNzc0NsYXNzKSB7IHJldHVybiBlbC5jbGFzc05hbWUubWF0Y2gobmV3IFJlZ0V4cCgnXFxcXGInICsgY3NzQ2xhc3MgKyAnXFxcXGInKSk7IH07CiAgICAgICAgICAgIHZhciByZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUucmVwbGFjZShuZXcgUmVnRXhwKCdcXFxcYicgKyBjc3NDbGFzcyArICdcXFxcYicpLCAnICcpOyB9OwogICAgICAgICAgICB2YXIgYWRkQ2xhc3MgPSBmdW5jdGlvbihlbCwgY3NzQ2xhc3MpIHsgaWYgKCFoYXNDbGFzcyhlbCwgY3NzQ2xhc3MpKSB7IGVsLmNsYXNzTmFtZSArPSBcIiBcIiArIGNzc0NsYXNzOyB9IH07CiAgICAgICAgICAgIHZhciB0b2dnbGVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjc3NDbGFzcykgeyBoYXNDbGFzcyhlbCwgY3NzQ2xhc3MpID8gcmVtb3ZlQ2xhc3MoZWwsIGNzc0NsYXNzKSA6IGFkZENsYXNzKGVsLCBjc3NDbGFzcyk7IH07CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9vcCA9IGZ1bmN0aW9uKCkge307CgogICAgICAgIHZhciBwcm9maWxlclN0b3JhZ2VLZXkgPSAnc3ltZm9ueS9wcm9maWxlci8nOwoKICAgICAgICB2YXIgYWRkRXZlbnRMaXN0ZW5lcjsKCiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgaWYgKCEoJ2FkZEV2ZW50TGlzdGVuZXInIGluIGVsKSkgewogICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50TmFtZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuYXR0YWNoRXZlbnQoJ29uJyArIGV2ZW50TmFtZSwgY2FsbGJhY2spOwogICAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgY2FsbGJhY2ssIGZhbHNlKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmIChuYXZpZ2F0b3IuY2xpcGJvYXJkKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1jbGlwYm9hcmQtdGV4dF0nKS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoZWxlbWVudCwgJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWNsaXBib2FyZC10ZXh0JykpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFiZWxcIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvbGRDb250ZW50ID0gZWxlbWVudC50ZXh0Q29udGVudDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gXCLinIUgQ29waWVkIVwiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwic3RhdHVzLXN1Y2Nlc3NcIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IG9sZENvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwic3RhdHVzLXN1Y2Nlc3NcIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA3MDAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlcXVlc3QgPSBmdW5jdGlvbih1cmwsIG9uU3VjY2Vzcywgb25FcnJvciwgcGF5bG9hZCwgb3B0aW9ucywgdHJpZXMpIHsKICAgICAgICAgICAgdmFyIHhociA9IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCA/IG5ldyBYTUxIdHRwUmVxdWVzdCgpIDogbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJyk7CiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgICBvcHRpb25zLnJldHJ5ID0gb3B0aW9ucy5yZXRyeSB8fCBmYWxzZTsKICAgICAgICAgICAgdHJpZXMgPSB0cmllcyB8fCAxOwogICAgICAgICAgICAvKiB0aGlzIGRlbGF5cyBmb3IgMTI1LCAzNzUsIDYyNSwgODc1LCBhbmQgMTAwMCwgLi4uICovCiAgICAgICAgICAgIHZhciBkZWxheSA9IHRyaWVzIDwgNSA/ICh0cmllcyAtIDAuNSkgKiAyNTAgOiAxMDAwOwoKICAgICAgICAgICAgeGhyLm9wZW4ob3B0aW9ucy5tZXRob2QgfHwgJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgJ1hNTEh0dHBSZXF1ZXN0Jyk7CiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgICAgICAgICAgaWYgKDQgIT09IHhoci5yZWFkeVN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT0gNDA0ICYmIG9wdGlvbnMucmV0cnkgJiYgIW9wdGlvbnMuc3RvcCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN0b3ApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KHVybCwgb25TdWNjZXNzLCBvbkVycm9yLCBwYXlsb2FkLCBvcHRpb25zLCB0cmllcyArIDEpOwogICAgICAgICAgICAgICAgICAgIH0sIGRlbGF5KTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKDIwMCA9PT0geGhyLnN0YXR1cykgewogICAgICAgICAgICAgICAgICAgIChvblN1Y2Nlc3MgfHwgbm9vcCkoeGhyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgKG9uRXJyb3IgfHwgbm9vcCkoeGhyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmIChvcHRpb25zLm9uU2VuZCkgewogICAgICAgICAgICAgICAgb3B0aW9ucy5vblNlbmQodHJpZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB4aHIuc2VuZChwYXlsb2FkIHx8ICcnKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgZ2V0UHJlZmVyZW5jZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb2ZpbGVyU3RvcmFnZUtleSArIG5hbWUpOwogICAgICAgIH07CgogICAgICAgIHZhciBzZXRQcmVmZXJlbmNlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvZmlsZXJTdG9yYWdlS2V5ICsgbmFtZSwgdmFsdWUpOwogICAgICAgIH07CgogICAgICAgIHZhciByZXF1ZXN0U3RhY2sgPSBbXTsKCiAgICAgICAgdmFyIGV4dHJhY3RIZWFkZXJzID0gZnVuY3Rpb24oeGhyLCBzdGFja0VsZW1lbnQpIHsKICAgICAgICAgICAgLyogSGVyZSB3ZSBhdm9pZCB0byBjYWxsIHhoci5nZXRSZXNwb25zZUhlYWRlciBpbiBvcmRlciB0byAqLwogICAgICAgICAgICAvKiBwcmV2ZW50IHBvbGx1dGluZyB0aGUgY29uc29sZSB3aXRoIENPUlMgc2VjdXJpdHkgZXJyb3JzICovCiAgICAgICAgICAgIHZhciBhbGxIZWFkZXJzID0geGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwogICAgICAgICAgICB2YXIgcmV0OwoKICAgICAgICAgICAgaWYgKHJldCA9IGFsbEhlYWRlcnMubWF0Y2goL154LWRlYnVnLXRva2VuOlxccysoLiopXCQvaW0pKSB7CiAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQucHJvZmlsZSA9IHJldFsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmV0ID0gYWxsSGVhZGVycy5tYXRjaCgvXngtZGVidWctdG9rZW4tbGluazpcXHMrKC4qKVwkL2ltKSkgewogICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnByb2ZpbGVyVXJsID0gcmV0WzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXQgPSBhbGxIZWFkZXJzLm1hdGNoKC9eU3ltZm9ueS1EZWJ1Zy1Ub29sYmFyLVJlcGxhY2U6XFxzKyguKilcJC9pbSkpIHsKICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC50b29sYmFyUmVwbGFjZUZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQudG9vbGJhclJlcGxhY2UgPSAnMScgPT09IHJldFsxXTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBzdWNjZXNzU3RyZWFrID0gNDsKICAgICAgICB2YXIgcGVuZGluZ1JlcXVlc3RzID0gMDsKICAgICAgICB2YXIgcmVuZGVyQWpheFJlcXVlc3RzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0Q291bnRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtcmVxdWVzdC1jb3VudGVyJyk7CiAgICAgICAgICAgIGlmICghcmVxdWVzdENvdW50ZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXF1ZXN0Q291bnRlci50ZXh0Q29udGVudCA9IHJlcXVlc3RTdGFjay5sZW5ndGg7CgogICAgICAgICAgICB2YXIgaW5mb1NwYW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNmLXRvb2xiYXItYWpheC1pbmZvXCIpOwogICAgICAgICAgICBpZiAoaW5mb1NwYW4pIHsKICAgICAgICAgICAgICAgIGluZm9TcGFuLnRleHRDb250ZW50ID0gcmVxdWVzdFN0YWNrLmxlbmd0aCArICcgQUpBWCByZXF1ZXN0JyArIChyZXF1ZXN0U3RhY2subGVuZ3RoICE9PSAxID8gJ3MnIDogJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWpheFRvb2xiYXJQYW5lbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWJsb2NrLWFqYXgnKTsKICAgICAgICAgICAgaWYgKHJlcXVlc3RTdGFjay5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGFqYXhUb29sYmFyUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhamF4VG9vbGJhclBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBlbmRpbmdSZXF1ZXN0cyA+IDApIHsKICAgICAgICAgICAgICAgIGFkZENsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi1hamF4LXJlcXVlc3QtbG9hZGluZycpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1Y2Nlc3NTdHJlYWsgPCA0KSB7CiAgICAgICAgICAgICAgICBhZGRDbGFzcyhhamF4VG9vbGJhclBhbmVsLCAnc2YtdG9vbGJhci1zdGF0dXMtcmVkJyk7CiAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhhamF4VG9vbGJhclBhbmVsLCAnc2YtYWpheC1yZXF1ZXN0LWxvYWRpbmcnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbW92ZUNsYXNzKGFqYXhUb29sYmFyUGFuZWwsICdzZi1hamF4LXJlcXVlc3QtbG9hZGluZycpOwogICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoYWpheFRvb2xiYXJQYW5lbCwgJ3NmLXRvb2xiYXItc3RhdHVzLXJlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHN0YXJ0QWpheFJlcXVlc3QgPSBmdW5jdGlvbihpbmRleCkgewogICAgICAgICAgICB2YXIgdGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1hamF4LXJlcXVlc3QtbGlzdCcpOwogICAgICAgICAgICBpZiAoIXRib2R5KSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBuYk9mQWpheFJlcXVlc3QgPSB0Ym9keS5yb3dzLmxlbmd0aDsKICAgICAgICAgICAgaWYgKG5iT2ZBamF4UmVxdWVzdCA+PSAxMDApIHsKICAgICAgICAgICAgICAgIHRib2R5LmRlbGV0ZVJvdygwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSByZXF1ZXN0U3RhY2tbaW5kZXhdOwogICAgICAgICAgICBwZW5kaW5nUmVxdWVzdHMrKzsKICAgICAgICAgICAgdmFyIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgIHJlcXVlc3QuRE9NTm9kZSA9IHJvdzsKCiAgICAgICAgICAgIHZhciByZXF1ZXN0TnVtYmVyQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIHJlcXVlc3ROdW1iZXJDZWxsLnRleHRDb250ZW50ID0gaW5kZXggKyAxOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQocmVxdWVzdE51bWJlckNlbGwpOwoKICAgICAgICAgICAgdmFyIHByb2ZpbGVyQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIHByb2ZpbGVyQ2VsbC50ZXh0Q29udGVudCA9ICduL2EnOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQocHJvZmlsZXJDZWxsKTsKCiAgICAgICAgICAgIHZhciBtZXRob2RDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgbWV0aG9kQ2VsbC50ZXh0Q29udGVudCA9IHJlcXVlc3QubWV0aG9kOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQobWV0aG9kQ2VsbCk7CgogICAgICAgICAgICB2YXIgdHlwZUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICB0eXBlQ2VsbC50ZXh0Q29udGVudCA9IHJlcXVlc3QudHlwZTsKICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHR5cGVDZWxsKTsKCiAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICBzdGF0dXNDb2RlLnRleHRDb250ZW50ID0gJ24vYSc7CiAgICAgICAgICAgIHN0YXR1c0NvZGVDZWxsLmFwcGVuZENoaWxkKHN0YXR1c0NvZGUpOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQoc3RhdHVzQ29kZUNlbGwpOwoKICAgICAgICAgICAgdmFyIHBhdGhDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICAgICAgICAgICAgcGF0aENlbGwuY2xhc3NOYW1lID0gJ3NmLWFqYXgtcmVxdWVzdC11cmwnOwogICAgICAgICAgICBpZiAoJ0dFVCcgPT09IHJlcXVlc3QubWV0aG9kKSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICBwYXRoTGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCByZXF1ZXN0LnVybCk7CiAgICAgICAgICAgICAgICBwYXRoTGluay50ZXh0Q29udGVudCA9IHJlcXVlc3QudXJsOwogICAgICAgICAgICAgICAgcGF0aENlbGwuYXBwZW5kQ2hpbGQocGF0aExpbmspOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGF0aENlbGwudGV4dENvbnRlbnQgPSByZXF1ZXN0LnVybDsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXRoQ2VsbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgcmVxdWVzdC51cmwpOwogICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQocGF0aENlbGwpOwoKICAgICAgICAgICAgdmFyIGR1cmF0aW9uQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICAgIGR1cmF0aW9uQ2VsbC5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0LWR1cmF0aW9uJzsKICAgICAgICAgICAgZHVyYXRpb25DZWxsLnRleHRDb250ZW50ID0gJ24vYSc7CiAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChkdXJhdGlvbkNlbGwpOwoKICAgICAgICAgICAgcmVxdWVzdC5saXZlRHVyYXRpb25IYW5kbGUgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGR1cmF0aW9uQ2VsbC50ZXh0Q29udGVudCA9IChuZXcgRGF0ZSgpIC0gcmVxdWVzdC5zdGFydCkgKyAnIG1zJzsKICAgICAgICAgICAgfSwgMTAwKTsKCiAgICAgICAgICAgIHJvdy5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0IHNmLWFqYXgtcmVxdWVzdC1sb2FkaW5nJzsKICAgICAgICAgICAgdGJvZHkuaW5zZXJ0QmVmb3JlKHJvdywgbnVsbCk7CgogICAgICAgICAgICB2YXIgdG9vbGJhckluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1ibG9jay1hamF4IC5zZi10b29sYmFyLWluZm8nKTsKICAgICAgICAgICAgdG9vbGJhckluZm8uc2Nyb2xsVG9wID0gdG9vbGJhckluZm8uc2Nyb2xsSGVpZ2h0OwoKICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzKCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGZpbmlzaEFqYXhSZXF1ZXN0ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSByZXF1ZXN0U3RhY2tbaW5kZXhdOwogICAgICAgICAgICBjbGVhckludGVydmFsKHJlcXVlc3QubGl2ZUR1cmF0aW9uSGFuZGxlKTsKCiAgICAgICAgICAgIGlmICghcmVxdWVzdC5ET01Ob2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnRvb2xiYXJSZXBsYWNlICYmICFyZXF1ZXN0LnRvb2xiYXJSZXBsYWNlRmluaXNoZWQgJiYgcmVxdWVzdC5wcm9maWxlKSB7CiAgICAgICAgICAgICAgICAvKiBGbGFnIGFzIGNvbXBsZXRlIGJlY2F1c2UgZmluaXNoQWpheFJlcXVlc3QgY2FuIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcy4gKi8KICAgICAgICAgICAgICAgIHJlcXVlc3QudG9vbGJhclJlcGxhY2VGaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAvKiBTZWFyY2ggdXAgdGhyb3VnaCB0aGUgRE9NIHRvIGZpbmQgdGhlIHRvb2xiYXIncyBjb250YWluZXIgSUQuICovCiAgICAgICAgICAgICAgICBmb3IgKHZhciBlbGVtID0gcmVxdWVzdC5ET01Ob2RlOyBlbGVtICYmIGVsZW0gIT09IGRvY3VtZW50OyBlbGVtID0gZWxlbS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uaWQubWF0Y2goL15zZndkdC8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNmanMubG9hZFRvb2xiYXIoZWxlbS5pZC5yZXBsYWNlKC9ec2Z3ZHQvLCAnJyksIHJlcXVlc3QucHJvZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGVuZGluZ1JlcXVlc3RzLS07CiAgICAgICAgICAgIHZhciByb3cgPSByZXF1ZXN0LkRPTU5vZGU7CiAgICAgICAgICAgIC8qIFVucGFjayB0aGUgY2hpbGRyZW4gZnJvbSB0aGUgcm93ICovCiAgICAgICAgICAgIHZhciBwcm9maWxlckNlbGwgPSByb3cuY2hpbGRyZW5bMV07CiAgICAgICAgICAgIHZhciBtZXRob2RDZWxsID0gcm93LmNoaWxkcmVuWzJdOwogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZUNlbGwgPSByb3cuY2hpbGRyZW5bNF07CiAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlRWxlbSA9IHN0YXR1c0NvZGVDZWxsLmNoaWxkcmVuWzBdOwogICAgICAgICAgICB2YXIgZHVyYXRpb25DZWxsID0gcm93LmNoaWxkcmVuWzZdOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QuZXJyb3IpIHsKICAgICAgICAgICAgICAgIHJvdy5jbGFzc05hbWUgPSAnc2YtYWpheC1yZXF1ZXN0IHNmLWFqYXgtcmVxdWVzdC1lcnJvcic7CiAgICAgICAgICAgICAgICBtZXRob2RDZWxsLmNsYXNzTmFtZSA9ICdzZi1hamF4LXJlcXVlc3QtZXJyb3InOwogICAgICAgICAgICAgICAgc3VjY2Vzc1N0cmVhayA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3cuY2xhc3NOYW1lID0gJ3NmLWFqYXgtcmVxdWVzdCBzZi1hamF4LXJlcXVlc3Qtb2snOwogICAgICAgICAgICAgICAgc3VjY2Vzc1N0cmVhaysrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXNDb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXNDb2RlIDwgMzAwKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZUVsZW0uc2V0QXR0cmlidXRlKCdjbGFzcycsICdzZi10b29sYmFyLXN0YXR1cycpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LnN0YXR1c0NvZGUgPCA0MDApIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXItc3RhdHVzIHNmLXRvb2xiYXItc3RhdHVzLXllbGxvdycpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXItc3RhdHVzIHNmLXRvb2xiYXItc3RhdHVzLXJlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdHVzQ29kZUVsZW0udGV4dENvbnRlbnQgPSByZXF1ZXN0LnN0YXR1c0NvZGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0dXNDb2RlRWxlbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3NmLXRvb2xiYXItc3RhdHVzIHNmLXRvb2xiYXItc3RhdHVzLXJlZCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgZHVyYXRpb25DZWxsLnRleHRDb250ZW50ID0gcmVxdWVzdC5kdXJhdGlvbiArICcgbXMnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVxdWVzdC5wcm9maWxlclVybCkgewogICAgICAgICAgICAgICAgcHJvZmlsZXJDZWxsLnRleHRDb250ZW50ID0gJyc7CiAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZXJMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgcHJvZmlsZXJMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHJlcXVlc3QucHJvZmlsZXJVcmwpOwogICAgICAgICAgICAgICAgcHJvZmlsZXJMaW5rLnRleHRDb250ZW50ID0gcmVxdWVzdC5wcm9maWxlOwogICAgICAgICAgICAgICAgcHJvZmlsZXJDZWxsLmFwcGVuZENoaWxkKHByb2ZpbGVyTGluayk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlbmRlckFqYXhSZXF1ZXN0cygpOwogICAgICAgIH07CgogICAgICAgIHslIGlmIGV4Y2x1ZGVkX2FqYXhfcGF0aHMgaXMgZGVmaW5lZCAlfQogICAgICAgICAgICBpZiAod2luZG93LmZldGNoICYmIHdpbmRvdy5mZXRjaC5wb2x5ZmlsbCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgb2xkRmV0Y2ggPSB3aW5kb3cuZmV0Y2g7CiAgICAgICAgICAgICAgICB3aW5kb3cuZmV0Y2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBvbGRGZXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBhcmd1bWVudHNbMF07CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGFyZ3VtZW50c1sxXTsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1UeXBlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZ3VtZW50c1swXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtVHlwZSA9PT0gJ1tvYmplY3QgUmVxdWVzdF0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IGFyZ3VtZW50c1swXS51cmw7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogYXJndW1lbnRzWzBdLm1ldGhvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzOiBhcmd1bWVudHNbMF0uY3JlZGVudGlhbHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBhcmd1bWVudHNbMF0uaGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6IGFyZ3VtZW50c1swXS5tb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3Q6IGFyZ3VtZW50c1swXS5yZWRpcmVjdAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IFN0cmluZyh1cmwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIXVybC5tYXRjaChuZXcgUmVnRXhwKHt7IGV4Y2x1ZGVkX2FqYXhfcGF0aHN8anNvbl9lbmNvZGV8cmF3IH19KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1ldGhvZCA9ICdHRVQnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5tZXRob2QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gcGFyYW1zLm1ldGhvZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YWNrRWxlbWVudCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZmV0Y2gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG5ldyBEYXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSByZXF1ZXN0U3RhY2sucHVzaChzdGFja0VsZW1lbnQpIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQuZHVyYXRpb24gPSBuZXcgRGF0ZSgpIC0gc3RhY2tFbGVtZW50LnN0YXJ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LmVycm9yID0gci5zdGF0dXMgPCAyMDAgfHwgci5zdGF0dXMgPj0gNDAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnN0YXR1c0NvZGUgPSByLnN0YXR1czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5wcm9maWxlID0gci5oZWFkZXJzLmdldCgneC1kZWJ1Zy10b2tlbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnByb2ZpbGVyVXJsID0gci5oZWFkZXJzLmdldCgneC1kZWJ1Zy10b2tlbi1saW5rJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja0VsZW1lbnQudG9vbGJhclJlcGxhY2VGaW5pc2hlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LnRvb2xiYXJSZXBsYWNlID0gJzEnID09PSByLmhlYWRlcnMuZ2V0KCdTeW1mb255LURlYnVnLVRvb2xiYXItUmVwbGFjZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LmVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmlzaEFqYXhSZXF1ZXN0KGlkeCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBzdGFydEFqYXhSZXF1ZXN0KGlkeCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCAmJiBYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgICAgICAgdmFyIHByb3hpZWQgPSBYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUub3BlbjsKCiAgICAgICAgICAgICAgICBYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKG1ldGhvZCwgdXJsLCBhc3luYywgdXNlciwgcGFzcykgewogICAgICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgICAgICAgICAgLyogcHJldmVudCBsb2dnaW5nIEFKQVggY2FsbHMgdG8gc3RhdGljIGFuZCBpbmxpbmUgZmlsZXMsIGxpa2UgdGVtcGxhdGVzICovCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGggPSB1cmw7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVybC5zbGljZSgwLCAxKSA9PT0gJy8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSB1cmwuaW5kZXhPZigne3sgcmVxdWVzdC5iYXNlUGF0aHxlKCdqcycpIH19JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSB1cmwuc2xpY2Uoe3sgcmVxdWVzdC5iYXNlUGF0aHxsZW5ndGggfX0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKDAgPT09IHVybC5pbmRleE9mKCd7eyAocmVxdWVzdC5zY2hlbWVBbmRIdHRwSG9zdCB+IHJlcXVlc3QuYmFzZVBhdGgpfGUoJ2pzJykgfX0nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gdXJsLnNsaWNlKHt7IChyZXF1ZXN0LnNjaGVtZUFuZEh0dHBIb3N0IH4gcmVxdWVzdC5iYXNlUGF0aCl8bGVuZ3RoIH19KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghcGF0aC5tYXRjaChuZXcgUmVnRXhwKHt7IGV4Y2x1ZGVkX2FqYXhfcGF0aHN8anNvbl9lbmNvZGV8cmF3IH19KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YWNrRWxlbWVudCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAneGhyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gcmVxdWVzdFN0YWNrLnB1c2goc3RhY2tFbGVtZW50KSAtIDE7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnJlYWR5U3RhdGUgPT0gNCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5kdXJhdGlvbiA9IG5ldyBEYXRlKCkgLSBzdGFja0VsZW1lbnQuc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tFbGVtZW50LmVycm9yID0gc2VsZi5zdGF0dXMgPCAyMDAgfHwgc2VsZi5zdGF0dXMgPj0gNDAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrRWxlbWVudC5zdGF0dXNDb2RlID0gc2VsZi5zdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdEhlYWRlcnMoc2VsZiwgc3RhY2tFbGVtZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaWR4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRBamF4UmVxdWVzdChpZHgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcHJveGllZC5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB7JSBlbmRpZiAlfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBoYXNDbGFzczogaGFzQ2xhc3MsCgogICAgICAgICAgICByZW1vdmVDbGFzczogcmVtb3ZlQ2xhc3MsCgogICAgICAgICAgICBhZGRDbGFzczogYWRkQ2xhc3MsCgogICAgICAgICAgICB0b2dnbGVDbGFzczogdG9nZ2xlQ2xhc3MsCgogICAgICAgICAgICBnZXRQcmVmZXJlbmNlOiBnZXRQcmVmZXJlbmNlLAoKICAgICAgICAgICAgc2V0UHJlZmVyZW5jZTogc2V0UHJlZmVyZW5jZSwKCiAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGFkZEV2ZW50TGlzdGVuZXIsCgogICAgICAgICAgICByZXF1ZXN0OiByZXF1ZXN0LAoKICAgICAgICAgICAgcmVuZGVyQWpheFJlcXVlc3RzOiByZW5kZXJBamF4UmVxdWVzdHMsCgogICAgICAgICAgICBnZXRTZndkdDogZnVuY3Rpb24odG9rZW4pIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZndkdCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2Z3ZHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2Z3ZHQnICsgdG9rZW4pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNmd2R0OwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbG9hZDogZnVuY3Rpb24oc2VsZWN0b3IsIHVybCwgb25TdWNjZXNzLCBvbkVycm9yLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxlY3Rvcik7CgogICAgICAgICAgICAgICAgaWYgKGVsICYmIGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1zZnVybCcpICE9PSB1cmwpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KAogICAgICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHhocikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0geGhyLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS1zZnVybCcsIHVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhlbCwgJ2xvYWRpbmcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwZW5kaW5nID0gcGVuZGluZ1JlcXVlc3RzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXF1ZXN0U3RhY2subGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydEFqYXhSZXF1ZXN0KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0U3RhY2tbaV0uZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoQWpheFJlcXVlc3QoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogUmV2ZXJ0IHRoZSBwZW5kaW5nIHN0YXRlIGluIGNhc2UgdGhlcmUgd2FzIGEgc3RhcnQgY2FsbGVkIHdpdGhvdXQgYSBmaW5pc2ggYWJvdmUuICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nUmVxdWVzdHMgPSBwZW5kaW5nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG9uU3VjY2VzcyB8fCBub29wKSh4aHIsIGVsKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oeGhyKSB7IChvbkVycm9yIHx8IG5vb3ApKHhociwgZWwpOyB9LAogICAgICAgICAgICAgICAgICAgICAgICAnJywKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93VG9vbGJhcjogZnVuY3Rpb24odG9rZW4pIHsKICAgICAgICAgICAgICAgIHZhciBzZndkdCA9IHRoaXMuZ2V0U2Z3ZHQodG9rZW4pOwogICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3Moc2Z3ZHQsICdzZi1kaXNwbGF5LW5vbmUnKTsKCiAgICAgICAgICAgICAgICBpZiAoZ2V0UHJlZmVyZW5jZSgndG9vbGJhci9kaXNwbGF5U3RhdGUnKSA9PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIHRva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZNaW5pVG9vbGJhci0nICsgdG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIHRva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyQ2xlYXJlci0nICsgdG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZk1pbmlUb29sYmFyLScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGhpZGVUb29sYmFyOiBmdW5jdGlvbih0b2tlbikgewogICAgICAgICAgICAgICAgdmFyIHNmd2R0ID0gdGhpcy5nZXRTZndkdCh0b2tlbik7CiAgICAgICAgICAgICAgICBhZGRDbGFzcyhzZndkdCwgJ3NmLWRpc3BsYXktbm9uZScpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdFRvb2xiYXI6IGZ1bmN0aW9uKHRva2VuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dUb29sYmFyKHRva2VuKTsKCiAgICAgICAgICAgICAgICB2YXIgaGlkZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJIaWRlQnV0dG9uLScgKyB0b2tlbik7CiAgICAgICAgICAgICAgICB2YXIgaGlkZUJ1dHRvblN2ZyA9IGhpZGVCdXR0b24ucXVlcnlTZWxlY3Rvcignc3ZnJyk7CiAgICAgICAgICAgICAgICBoaWRlQnV0dG9uU3ZnLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgaGlkZUJ1dHRvblN2Zy5zZXRBdHRyaWJ1dGUoJ2ZvY3VzYWJsZScsICdmYWxzZScpOwogICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihoaWRlQnV0dG9uLCAnY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgKHAucHJldmlvdXNFbGVtZW50U2libGluZyB8fCBwLnByZXZpb3VzU2libGluZykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZNaW5pVG9vbGJhci0nICsgdG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgIHNldFByZWZlcmVuY2UoJ3Rvb2xiYXIvZGlzcGxheVN0YXRlJywgJ25vbmUnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHZhciBzaG93QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmVG9vbGJhck1pbmlUb2dnbGVyLScgKyB0b2tlbik7CiAgICAgICAgICAgICAgICB2YXIgc2hvd0J1dHRvblN2ZyA9IHNob3dCdXR0b24ucXVlcnlTZWxlY3Rvcignc3ZnJyk7CiAgICAgICAgICAgICAgICBzaG93QnV0dG9uU3ZnLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgc2hvd0J1dHRvblN2Zy5zZXRBdHRyaWJ1dGUoJ2ZvY3VzYWJsZScsICdmYWxzZScpOwogICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihzaG93QnV0dG9uLCAnY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbS5zdHlsZS5kaXNwbGF5ID09ICdub25lJykgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIHRva2VuKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyQ2xlYXJlci0nICsgdG9rZW4pLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmVG9vbGJhck1haW5Db250ZW50LScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZlRvb2xiYXJDbGVhcmVyLScgKyB0b2tlbikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uc3R5bGUuZGlzcGxheSA9ICdub25lJwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgc2V0UHJlZmVyZW5jZSgndG9vbGJhci9kaXNwbGF5U3RhdGUnLCAnYmxvY2snKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbG9hZFRvb2xiYXI6IGZ1bmN0aW9uKHRva2VuLCBuZXdUb2tlbikgewogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIHRyaWVzQ291bnRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZkxvYWRDb3VudGVyLScgKyB0b2tlbik7CgogICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgcmV0cnk6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgb25TZW5kOiBmdW5jdGlvbiAoY291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmluaXRUb29sYmFyKHRva2VuKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyaWVzQ291bnRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZXNDb3VudGVyLnRleHRDb250ZW50ID0gY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICB2YXIgY2FuY2VsQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NmTG9hZENhbmNlbC0nICsgdG9rZW4pOwogICAgICAgICAgICAgICAgaWYgKGNhbmNlbEJ1dHRvbikgewogICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoY2FuY2VsQnV0dG9uLCAnY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc3RvcCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGlkZVRvb2xiYXIodG9rZW4pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG5ld1Rva2VuID0gKG5ld1Rva2VuIHx8IHRva2VuKTsKCiAgICAgICAgICAgICAgICB0aGlzLmxvYWQoCiAgICAgICAgICAgICAgICAgICAgJ3Nmd2R0JyArIHRva2VuLAogICAgICAgICAgICAgICAgICAgICd7eyB1cmwoXCJfd2R0XCIsIHsgXCJ0b2tlblwiOiBcInh4eHh4eFwiIH0pfGVzY2FwZSgnanMnKSB9fScucmVwbGFjZSgveHh4eHh4LywgbmV3VG9rZW4pLAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHhociwgZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyogRG8gbm90aGluZyBpbiB0aGUgZWRnZSBjYXNlIHdoZXJlIHRoZSB0b29sYmFyIGhhcyBhbHJlYWR5IGJlZW4gcmVwbGFjZWQgd2l0aCBhIG5ldyBvbmUgKi8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZUb29sYmFyTWFpbkNvbnRlbnQtJyArIG5ld1Rva2VuKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvKiBFdmFsdWF0ZSBpbiBnbG9iYWwgc2NvcGUgc2NyaXB0cyBlbWJlZGRlZCBpbnNpZGUgdGhlIHRvb2xiYXIgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGksIHNjcmlwdHMgPSBbXS5zbGljZS5jYWxsKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdCcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNjcmlwdHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWwuY2FsbCh7fSwgc2NyaXB0c1tpXS5maXJzdENoaWxkLm5vZGVWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAtMSAhPT0geGhyLnJlc3BvbnNlVGV4dC5pbmRleE9mKCdzZi10b29sYmFycmVzZXQnKSA/ICdibG9jaycgOiAnbm9uZSc7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwuc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pbml0VG9vbGJhcihuZXdUb2tlbik7CgogICAgICAgICAgICAgICAgICAgICAgICAvKiBIYW5kbGUgdG9vbGJhci1pbmZvIHBvc2l0aW9uICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b29sYmFyQmxvY2tzID0gW10uc2xpY2UuY2FsbChlbC5xdWVyeVNlbGVjdG9yQWxsKCcuc2YtdG9vbGJhci1ibG9jaycpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRvb2xiYXJCbG9ja3MubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJCbG9ja3NbaV0ub25tb3VzZW92ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvb2xiYXJJbmZvID0gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCcuc2YtdG9vbGJhci1pbmZvJylbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2VXaWR0aCA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRXaWR0aCA9IHRvb2xiYXJJbmZvLm9mZnNldFdpZHRoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0VmFsdWUgPSAoZWxlbWVudFdpZHRoICsgdGhpcy5vZmZzZXRMZWZ0KSAtIHBhZ2VXaWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmlnaHRWYWx1ZSA9IChlbGVtZW50V2lkdGggKyAocGFnZVdpZHRoIC0gdGhpcy5vZmZzZXRMZWZ0KSkgLSBwYWdlV2lkdGg7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIFJlc2V0IHJpZ2h0IGFuZCBsZWZ0IHZhbHVlLCB1c2VmdWwgb24gd2luZG93IHJlc2l6ZSAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLnJpZ2h0ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckluZm8uc3R5bGUubGVmdCA9ICcnOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudFdpZHRoID4gcGFnZVdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLmxlZnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChsZWZ0VmFsdWUgPiAwICYmIHJpZ2h0VmFsdWUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJbmZvLnN0eWxlLnJpZ2h0ID0gKHJpZ2h0VmFsdWUgKiAtMSkgKyAncHgnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGVmdFZhbHVlIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFySW5mby5zdHlsZS5sZWZ0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFySW5mby5zdHlsZS5yaWdodCA9ICcwcHgnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckFqYXhSZXF1ZXN0cygpOwogICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWFqYXgtY2xlYXInKSwgJ2NsaWNrJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0U3RhY2sgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckFqYXhSZXF1ZXN0cygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1N0cmVhayA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1hamF4LXJlcXVlc3QtbGlzdCcpLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2YtdG9vbGJhci1ibG9jay1hamF4JyksICdtb3VzZWVudGVyJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZi10b29sYmFyLWJsb2NrLWFqYXggLnNmLXRvb2xiYXItaW5mbycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5zY3JvbGxUb3AgPSBlbGVtLnNjcm9sbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stYWpheCA+IC5zZi10b29sYmFyLWljb24nKSwgJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMucGFyZW50Tm9kZSwgJ2hvdmVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGR1bXBJbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNmLXRvb2xiYXItYmxvY2stZHVtcCAuc2YtdG9vbGJhci1pbmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBkdW1wSW5mbykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihkdW1wSW5mbywgJ3NmYmVmb3JlZHVtcGNvbGxhcHNlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1bXBJbmZvLnN0eWxlLm1pbkhlaWdodCA9IGR1bXBJbmZvLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCsncHgnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKGR1bXBJbmZvLCAnbW91c2VsZWF2ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdW1wSW5mby5zdHlsZS5taW5IZWlnaHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbih4aHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgIT09IDAgJiYgIW9wdGlvbnMuc3RvcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNmd2R0ID0gdGhhdC5nZXRTZndkdCh0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZndkdC5pbm5lckhUTUwgPSAnXFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2YtdG9vbGJhcnJlc2V0IG5vdHJhbnNsYXRlXCI+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNmLXRvb2xiYXItaWNvblwiPjxzdmcgd2lkdGg9XCIyNlwiIGhlaWdodD1cIjI4XCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZlcnNpb249XCIxLjFcIiB4PVwiMHB4XCIgeT1cIjBweFwiIHZpZXdCb3g9XCIwIDAgMjYgMjhcIiBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjYgMjhcIiB4bWw6c3BhY2U9XCJwcmVzZXJ2ZVwiPjxwYXRoIGZpbGw9XCIjRkZGRkZGXCIgZD1cIk0xMyAwQzUuOCAwIDAgNS44IDAgMTNjMCA3LjIgNS44IDEzIDEzIDEzYzcuMiAwIDEzLTUuOCAxMy0xM0MyNiA1LjggMjAuMiAwIDEzIDB6IE0yMCA3LjUgYy0wLjYgMC0xLTAuMy0xLTAuOWMwLTAuMiAwLTAuNCAwLjItMC42YzAuMS0wLjMgMC4yLTAuMyAwLjItMC40YzAtMC4zLTAuNS0wLjQtMC43LTAuNGMtMiAwLjEtMi41IDIuNy0yLjkgNC44bC0wLjIgMS4xIGMxLjEgMC4yIDEuOSAwIDIuNC0wLjNjMC42LTAuNC0wLjItMC44LTAuMS0xLjNDMTggOS4yIDE4LjQgOSAxOC43IDguOWMwLjUgMCAwLjggMC41IDAuOCAxYzAgMC44LTEuMSAyLTMuMyAxLjkgYy0wLjMgMC0wLjUgMC0wLjctMC4xTDE1IDE0LjFjLTAuNCAxLjctMC45IDQuMS0yLjYgNi4yYy0xLjUgMS44LTMuMSAyLjEtMy44IDIuMWMtMS4zIDAtMi4xLTAuNi0yLjItMS42YzAtMC45IDAuOC0xLjQgMS4zLTEuNCBjMC43IDAgMS4yIDAuNSAxLjIgMS4xYzAgMC41LTAuMiAwLjYtMC40IDAuN2MtMC4xIDAuMS0wLjMgMC4yLTAuMyAwLjRjMCAwLjEgMC4xIDAuMyAwLjQgMC4zYzAuNSAwIDAuOS0wLjMgMS4yLTAuNSBjMS4zLTEgMS43LTIuOSAyLjQtNi4ybDAuMS0wLjhjMC4yLTEuMSAwLjUtMi4zIDAuOC0zLjVjLTAuOS0wLjctMS40LTEuNS0yLjYtMS44Yy0wLjgtMC4yLTEuMyAwLTEuNyAwLjRDOC40IDEwIDguNiAxMC43IDkgMTEuMSBsMC43IDAuN2MwLjggMC45IDEuMyAxLjcgMS4xIDIuN2MtMC4zIDEuNi0yLjEgMi44LTQuMyAyLjFjLTEuOS0wLjYtMi4yLTEuOS0yLTIuN2MwLjItMC42IDAuNy0wLjggMS4yLTAuNiBjMC41IDAuMiAwLjcgMC44IDAuNiAxLjNjMCAwLjEgMCAwLjEtMC4xIDAuM0M2IDE1IDUuOSAxNS4yIDUuOSAxNS4zYy0wLjEgMC40IDAuNCAwLjcgMC44IDAuOGMwLjggMC4zIDEuNy0wLjIgMS45LTAuOSBjMC4yLTAuNi0wLjItMS4xLTAuNC0xLjJsLTAuOC0wLjljLTAuNC0wLjQtMS4yLTEuNS0wLjgtMi44YzAuMi0wLjUgMC41LTEgMC45LTEuNGMxLTAuNyAyLTAuOCAzLTAuNmMxLjMgMC40IDEuOSAxLjIgMi44IDEuOSBjMC41LTEuMyAxLjEtMi42IDItMy44YzAuOS0xIDItMS43IDMuMy0xLjhDMjAgNC44IDIxIDUuNCAyMSA2LjNDMjEgNi43IDIwLjggNy41IDIwIDcuNXpcIi8+PC9zdmc+PC9kaXY+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgbG9hZGluZyB0aGUgd2ViIGRlYnVnIHRvb2xiYXIuIDxhIGhyZWY9XCJ7eyB1cmwoXCJfcHJvZmlsZXJfaG9tZVwiKXxlc2NhcGUoJ2pzJykgfX0nICsgbmV3VG9rZW4gKyAnPk9wZW4gdGhlIHdlYiBwcm9maWxlci48L2E+XFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNmd2R0LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2YtdG9vbGJhciBzZi1lcnJvci10b29sYmFyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKHNlbGVjdG9yLCBlbE9uLCBlbE9mZikgewogICAgICAgICAgICAgICAgdmFyIHRtcCA9IGVsT24uc3R5bGUuZGlzcGxheSwKICAgICAgICAgICAgICAgICAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGVjdG9yKTsKCiAgICAgICAgICAgICAgICBlbE9uLnN0eWxlLmRpc3BsYXkgPSBlbE9mZi5zdHlsZS5kaXNwbGF5OwogICAgICAgICAgICAgICAgZWxPZmYuc3R5bGUuZGlzcGxheSA9IHRtcDsKCiAgICAgICAgICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnID09PSB0bXAgPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlVGFiczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdGFiR3JvdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNmLXRhYnM6bm90KFtkYXRhLXByb2Nlc3NlZD10cnVlXSknKTsKCiAgICAgICAgICAgICAgICAvKiBjcmVhdGUgdGhlIHRhYiBuYXZpZ2F0aW9uIGZvciBlYWNoIGdyb3VwIG9mIHRhYnMgKi8KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFiR3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRhYnMgPSB0YWJHcm91cHNbaV0ucXVlcnlTZWxlY3RvckFsbCgnOnNjb3BlID4gLnRhYicpOwogICAgICAgICAgICAgICAgICAgIHZhciB0YWJOYXZpZ2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsKICAgICAgICAgICAgICAgICAgICB0YWJOYXZpZ2F0aW9uLmNsYXNzTmFtZSA9ICd0YWItbmF2aWdhdGlvbic7CgogICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFRhYklkID0gJ3RhYi0nICsgaSArICctMCc7IC8qIHNlbGVjdCB0aGUgZmlyc3QgdGFiIGJ5IGRlZmF1bHQgKi8KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYklkID0gJ3RhYi0nICsgaSArICctJyArIGo7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJUaXRsZSA9IHRhYnNbal0ucXVlcnlTZWxlY3RvcignLnRhYi10aXRsZScpLmlubmVySFRNTDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJOYXZpZ2F0aW9uSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb25JdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS10YWItaWQnLCB0YWJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNDbGFzcyh0YWJzW2pdLCAnYWN0aXZlJykpIHsgc2VsZWN0ZWRUYWJJZCA9IHRhYklkOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNDbGFzcyh0YWJzW2pdLCAnZGlzYWJsZWQnKSkgeyBhZGRDbGFzcyh0YWJOYXZpZ2F0aW9uSXRlbSwgJ2Rpc2FibGVkJyk7IH0KICAgICAgICAgICAgICAgICAgICAgICAgdGFiTmF2aWdhdGlvbkl0ZW0uaW5uZXJIVE1MID0gdGFiVGl0bGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb24uYXBwZW5kQ2hpbGQodGFiTmF2aWdhdGlvbkl0ZW0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYkNvbnRlbnQgPSB0YWJzW2pdLnF1ZXJ5U2VsZWN0b3IoJy50YWItY29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0YWJDb250ZW50LnBhcmVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIHRhYklkKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRhYkdyb3Vwc1tpXS5pbnNlcnRCZWZvcmUodGFiTmF2aWdhdGlvbiwgdGFiR3JvdXBzW2ldLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXRhYi1pZD1cIicgKyBzZWxlY3RlZFRhYklkICsgJ1wiXScpLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLyogZGlzcGxheSB0aGUgYWN0aXZlIHRhYiBhbmQgYWRkIHRoZSAnY2xpY2snIGV2ZW50IGxpc3RlbmVycyAqLwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRhYkdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRhYk5hdmlnYXRpb24gPSB0YWJHcm91cHNbaV0ucXVlcnlTZWxlY3RvckFsbCgnOnNjb3BlID4gLnRhYi1uYXZpZ2F0aW9uIGxpJyk7CgogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB0YWJOYXZpZ2F0aW9uLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhYklkID0gdGFiTmF2aWdhdGlvbltqXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFiLWlkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5xdWVyeVNlbGVjdG9yKCcudGFiLXRpdGxlJykuY2xhc3NOYW1lID0gJ2hpZGRlbic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQ2xhc3ModGFiTmF2aWdhdGlvbltqXSwgJ2FjdGl2ZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJJZCkuY2xhc3NOYW1lID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5jbGFzc05hbWUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGFiTmF2aWdhdGlvbltqXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3RpdmVUYWIgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbmVlZGVkIGJlY2F1c2Ugd2hlbiB0aGUgdGFiIGNvbnRhaW5zIEhUTUwgY29udGVudHMsIHVzZXIgY2FuIGNsaWNrICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBvbiBhbnkgb2YgdGhvc2UgZWxlbWVudHMgaW5zdGVhZCBvZiB0aGVpciBwYXJlbnQgJzxsaT4nIGVsZW1lbnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChhY3RpdmVUYWIudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnbGknKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlVGFiID0gYWN0aXZlVGFiLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZ2V0IHRoZSBmdWxsIGxpc3Qgb2YgdGFicyB0aHJvdWdoIHRoZSBwYXJlbnQgb2YgdGhlIGFjdGl2ZSB0YWIgZWxlbWVudCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYk5hdmlnYXRpb24gPSBhY3RpdmVUYWIucGFyZW50Tm9kZS5jaGlsZHJlbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGFiTmF2aWdhdGlvbi5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJJZCA9IHRhYk5hdmlnYXRpb25ba10uZ2V0QXR0cmlidXRlKCdkYXRhLXRhYi1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYklkKS5jbGFzc05hbWUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyh0YWJOYXZpZ2F0aW9uW2tdLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ2xhc3MoYWN0aXZlVGFiLCAnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlVGFiSWQgPSBhY3RpdmVUYWIuZ2V0QXR0cmlidXRlKCdkYXRhLXRhYi1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYWN0aXZlVGFiSWQpLmNsYXNzTmFtZSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGFiR3JvdXBzW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9jZXNzZWQnLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlVG9nZ2xlczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdG9nZ2xlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi10b2dnbGU6bm90KFtkYXRhLXByb2Nlc3NlZD10cnVlXSknKTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvZ2dsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudFNlbGVjdG9yID0gdG9nZ2xlc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLXNlbGVjdG9yJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnRTZWxlY3Rvcik7CgogICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtY29udGVudCcpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodG9nZ2xlc1tpXS5oYXNBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWluaXRpYWwnKSAmJiB0b2dnbGVzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUtaW5pdGlhbCcpID09ICdkaXNwbGF5JykgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRDbGFzcyh0b2dnbGVzW2ldLCAnc2YtdG9nZ2xlLW9uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtdmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKHRvZ2dsZXNbaV0sICdzZi10b2dnbGUtb2ZmJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKHRvZ2dsZXNbaV0sICdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCcnICE9PSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogRG9uJ3QgZG8gYW55dGhpbmcgb24gdGV4dCBzZWxlY3Rpb24gKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvZ2dsZSA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIG5lZWRlZCBiZWNhdXNlIHdoZW4gdGhlIHRvZ2dsZSBjb250YWlucyBIVE1MIGNvbnRlbnRzLCB1c2VyIGNhbiBjbGljayAqLwogICAgICAgICAgICAgICAgICAgICAgICAvKiBvbiBhbnkgb2YgdGhvc2UgZWxlbWVudHMgaW5zdGVhZCBvZiB0aGVpciBwYXJlbnQgJy5zZi10b2dnbGUnIGVsZW1lbnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFoYXNDbGFzcyh0b2dnbGUsICdzZi10b2dnbGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlID0gdG9nZ2xlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0b2dnbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1zZWxlY3RvcicpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHRvZ2dsZSwgJ3NmLXRvZ2dsZS1vbicpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVDbGFzcyh0b2dnbGUsICdzZi10b2dnbGUtb2ZmJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGVsZW1lbnQsICdzZi10b2dnbGUtdmlzaWJsZScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLyogdGhlIHRvZ2dsZSBkb2Vzbid0IGNoYW5nZSBpdHMgY29udGVudHMgd2hlbiBjbGlja2luZyBvbiBpdCAqLwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRvZ2dsZS5oYXNBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWFsdC1jb250ZW50JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2dnbGUuaGFzQXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1vcmlnaW5hbC1jb250ZW50JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLW9yaWdpbmFsLWNvbnRlbnQnLCB0b2dnbGUuaW5uZXJIVE1MKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDb250ZW50ID0gdG9nZ2xlLmlubmVySFRNTDsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdpbmFsQ29udGVudCA9IHRvZ2dsZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLW9yaWdpbmFsLWNvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsdENvbnRlbnQgPSB0b2dnbGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1hbHQtY29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGUuaW5uZXJIVE1MID0gY3VycmVudENvbnRlbnQgIT09IGFsdENvbnRlbnQgPyBhbHRDb250ZW50IDogb3JpZ2luYWxDb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvKiBQcmV2ZW50cyBmcm9tIGRpc2FsbG93aW5nIGNsaWNrcyBvbiBsaW5rcyBpbnNpZGUgdG9nZ2xlcyAqLwogICAgICAgICAgICAgICAgICAgIHZhciB0b2dnbGVMaW5rcyA9IHRvZ2dsZXNbaV0ucXVlcnlTZWxlY3RvckFsbCgnYScpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdG9nZ2xlTGlua3MubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcih0b2dnbGVMaW5rc1tqXSwgJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvKiBQcmV2ZW50cyBmcm9tIGRpc2FsbG93aW5nIGNsaWNrcyBvbiBcImNvcHkgdG8gY2xpcGJvYXJkXCIgZWxlbWVudHMgaW5zaWRlIHRvZ2dsZXMgKi8KICAgICAgICAgICAgICAgICAgICB2YXIgY29weVRvQ2xpcGJvYXJkRWxlbWVudHMgPSB0b2dnbGVzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NwYW5bZGF0YS1jbGlwYm9hcmQtdGV4dF0nKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGNvcHlUb0NsaXBib2FyZEVsZW1lbnRzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoY29weVRvQ2xpcGJvYXJkRWxlbWVudHNba10sICdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlc1tpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvY2Vzc2VkJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemVMb2dzVGFibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgU2Zqcy51cGRhdGVMb2dzVGFibGUoKTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubG9nLWZpbHRlciBpbnB1dCcpLmZvckVhY2goKGlucHV0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4geyBTZmpzLnVwZGF0ZUxvZ3NUYWJsZSgpOyB9KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItc2VsZWN0LWFsbC1vci1ub25lIGJ1dHRvbicpLmZvckVhY2goKGxpbmspID0+IHsKICAgICAgICAgICAgICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RBbGwgPSBsaW5rLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0LWFsbCcpOwogICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmNsb3Nlc3QoJy5sb2ctZmlsdGVyLWNvbnRlbnQnKS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCcpLmZvckVhY2goKGlucHV0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gc2VsZWN0QWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIFNmanMudXBkYXRlTG9nc1RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGV0YWlscy5sb2ctZmlsdGVyJykuZm9yRWFjaCgoZmlsdGVyRWxlbWVudCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbHRlckVsZW1lbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSAmJiBmaWx0ZXJFbGVtZW50Lm9wZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckVsZW1lbnQub3BlbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemVNYWlsZXJUYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlbWFpbFJvd3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWFpbGVyLWVtYWlsLXN1bW1hcnktdGFibGUtcm93Jyk7CgogICAgICAgICAgICAgICAgZW1haWxSb3dzLmZvckVhY2goKGVtYWlsUm93KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZW1haWxSb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsUm93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWxSb3dzLmZvckVhY2goKHJvdykgPT4gcm93LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsUm93LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tYWlsZXItZW1haWwtZGV0YWlscycpLmZvckVhY2goKGVtYWlsRGV0YWlscykgPT4gZW1haWxEZXRhaWxzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbWFpbFJvdy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFyZ2V0JykpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlTG9nc1RhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVHlwZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsb2ctZmlsdGVyLXR5cGUgaW5wdXQ6Y2hlY2tlZCcpLnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3QgcHJpb3JpdGllcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNsb2ctZmlsdGVyLXByaW9yaXR5IGlucHV0Jyk7CiAgICAgICAgICAgICAgICBjb25zdCBhbGxQcmlvcml0aWVzID0gQXJyYXkuZnJvbShwcmlvcml0aWVzKS5tYXAoKGlucHV0KSA9PiBpbnB1dC52YWx1ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFByaW9yaXRpZXMgPSBBcnJheS5mcm9tKHByaW9yaXRpZXMpLmZpbHRlcigoaW5wdXQpID0+IGlucHV0LmNoZWNrZWQpLm1hcCgoaW5wdXQpID0+IGlucHV0LnZhbHVlKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNoYW5uZWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2xvZy1maWx0ZXItY2hhbm5lbCBpbnB1dCcpOwogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRDaGFubmVscyA9IEFycmF5LmZyb20oY2hhbm5lbHMpLmZpbHRlcigoaW5wdXQpID0+IGlucHV0LmNoZWNrZWQpLm1hcCgoaW5wdXQpID0+IGlucHV0LnZhbHVlKTsKCiAgICAgICAgICAgICAgICBjb25zdCBsb2dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGFibGUubG9ncycpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IGxvZ3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLyogaGlkZSByb3dzIHRoYXQgZG9uJ3QgbWF0Y2ggdGhlIGN1cnJlbnQgZmlsdGVycyAqLwogICAgICAgICAgICAgICAgbGV0IG51bVZpc2libGVSb3dzID0gMDsKICAgICAgICAgICAgICAgIGxvZ3MucXVlcnlTZWxlY3RvckFsbCgndGJvZHkgdHInKS5mb3JFYWNoKChyb3cpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoJ2FsbCcgIT09IHNlbGVjdGVkVHlwZSAmJiBzZWxlY3RlZFR5cGUgIT09IHJvdy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHlwZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmlvcml0eSA9IHJvdy5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJpb3JpdHknKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmFsc2UgPT09IHNlbGVjdGVkUHJpb3JpdGllcy5pbmNsdWRlcyhwcmlvcml0eSkgJiYgdHJ1ZSA9PT0gYWxsUHJpb3JpdGllcy5pbmNsdWRlcyhwcmlvcml0eSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcm93LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgnJyAhPT0gcm93LmdldEF0dHJpYnV0ZSgnZGF0YS1jaGFubmVsJykgJiYgZmFsc2UgPT09IHNlbGVjdGVkQ2hhbm5lbHMuaW5jbHVkZXMocm93LmdldEF0dHJpYnV0ZSgnZGF0YS1jaGFubmVsJykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByb3cuc3R5bGUuZGlzcGxheSA9ICd0YWJsZS1yb3cnOwogICAgICAgICAgICAgICAgICAgIG51bVZpc2libGVSb3dzKys7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0YWJsZS5sb2dzJykuc3R5bGUuZGlzcGxheSA9IDAgPT09IG51bVZpc2libGVSb3dzID8gJ25vbmUnIDogJ3RhYmxlJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uby1sb2dzLW1lc3NhZ2UnKS5zdHlsZS5kaXNwbGF5ID0gMCA9PT0gbnVtVmlzaWJsZVJvd3MgPyAnYmxvY2snIDogJ25vbmUnOwoKICAgICAgICAgICAgICAgIC8qIHVwZGF0ZSB0aGUgc2VsZWN0ZWQgdG90YWxzIG9mIGFsbCBmaWx0ZXJzICovCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbG9nLWZpbHRlci1wcmlvcml0eSAuZmlsdGVyLWFjdGl2ZS1udW0nKS5pbm5lclRleHQgPSAocHJpb3JpdGllcy5sZW5ndGggPT09IHNlbGVjdGVkUHJpb3JpdGllcy5sZW5ndGgpID8gJ0FsbCcgOiBzZWxlY3RlZFByaW9yaXRpZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvZy1maWx0ZXItY2hhbm5lbCAuZmlsdGVyLWFjdGl2ZS1udW0nKS5pbm5lclRleHQgPSAoY2hhbm5lbHMubGVuZ3RoID09PSBzZWxlY3RlZENoYW5uZWxzLmxlbmd0aCkgPyAnQWxsJyA6IHNlbGVjdGVkQ2hhbm5lbHMubGVuZ3RoOwoKICAgICAgICAgICAgICAgIC8qIHVwZGF0ZSB0aGUgY3VycmVudGx5IHNlbGVjdGVkIFwibG9nIHR5cGVcIiB0YWIgKi8KICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNsb2ctZmlsdGVyLXR5cGUgbGknKS5mb3JFYWNoKCh0YWIpID0+IHRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjbG9nLWZpbHRlci10eXBlIGlucHV0W3ZhbHVlPVwiXCR7c2VsZWN0ZWRUeXBlfVwiXWApLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgfTsKICAgIH0pKCk7CgogICAgU2Zqcy5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCAnRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIFNmanMuY3JlYXRlVGFicygpOwogICAgICAgIFNmanMuY3JlYXRlVG9nZ2xlcygpOwogICAgfSk7Cn0KLypdXT4qLzwvc2NyaXB0PgoiLCAiQFdlYlByb2ZpbGVyL1Byb2ZpbGVyL2Jhc2VfanMuaHRtbC50d2lnIiwgIi9BcHBsaWNhdGlvbnMvWEFNUFAveGFtcHBmaWxlcy9odGRvY3MvdGFyZWE1X2FsdmFyb1RhcGlhZG9yL3ZlbmRvci9zeW1mb255L3dlYi1wcm9maWxlci1idW5kbGUvUmVzb3VyY2VzL3ZpZXdzL1Byb2ZpbGVyL2Jhc2VfanMuaHRtbC50d2lnIik7CiAgICB9Cn0KIjtzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG5hbWVzcGFjZXMiO2E6MDp7fXM6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAaW5jbHVkZXMiO2E6MDp7fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAZnVuY3Rpb25zIjthOjA6e31zOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGNvbnN0YW50cyI7YTowOnt9czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBjbGFzc2VzIjthOjE6e3M6NDg6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYSI7TzozNToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18iOjEzOntzOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AZnFzZW4iO086MzA6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbiI6Mjp7czozNzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBmcXNlbiI7czo0ODoiXF9fVHdpZ1RlbXBsYXRlX2YwNzExNWJiYTgzY2YwMDljOGMxYmJhODAyMWJiYTJhIjtzOjM2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAG5hbWUiO3M6NDc6Il9fVHdpZ1RlbXBsYXRlX2YwNzExNWJiYTgzY2YwMDljOGMxYmJhODAyMWJiYTJhIjt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGRvY0Jsb2NrIjtOO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBhYnN0cmFjdCI7YjowO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBmaW5hbCI7YjowO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBwYXJlbnQiO086MzA6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbiI6Mjp7czozNzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBmcXNlbiI7czoxNDoiXFR3aWdcVGVtcGxhdGUiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czo4OiJUZW1wbGF0ZSI7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBpbXBsZW1lbnRzIjthOjA6e31zOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AY29uc3RhbnRzIjthOjA6e31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AcHJvcGVydGllcyI7YToyOntzOjU3OiJcX19Ud2lnVGVtcGxhdGVfZjA3MTE1YmJhODNjZjAwOWM4YzFiYmE4MDIxYmJhMmE6OiRzb3VyY2UiO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkiOjExOntzOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjU3OiJcX19Ud2lnVGVtcGxhdGVfZjA3MTE1YmJhODNjZjAwOWM4YzFiYmE4MDIxYmJhMmE6OiRzb3VyY2UiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czo2OiJzb3VyY2UiO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBkb2NCbG9jayI7TjtzOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQB0eXBlcyI7YTowOnt9czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAZGVmYXVsdCI7TjtzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBzdGF0aWMiO2I6MDtzOjQ5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQB2aXNpYmlsaXR5IjtPOjM5OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkiOjE6e3M6NTE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkAdmlzaWJpbGl0eSI7czo3OiJwcml2YXRlIjt9czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjE4O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NTA6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AGVuZExvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aToxODtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQB0eXBlIjtOO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AHJlYWRPbmx5IjtiOjA7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAbWV0YWRhdGEiO2E6MDp7fX1zOjU3OiJcX19Ud2lnVGVtcGxhdGVfZjA3MTE1YmJhODNjZjAwOWM4YzFiYmE4MDIxYmJhMmE6OiRtYWNyb3MiO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkiOjExOntzOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjU3OiJcX19Ud2lnVGVtcGxhdGVfZjA3MTE1YmJhODNjZjAwOWM4YzFiYmE4MDIxYmJhMmE6OiRtYWNyb3MiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czo2OiJtYWNyb3MiO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBkb2NCbG9jayI7TjtzOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQB0eXBlcyI7YTowOnt9czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAZGVmYXVsdCI7czoyOiJbXSI7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAc3RhdGljIjtiOjA7czo0OToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAdmlzaWJpbGl0eSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5IjoxOntzOjUxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5AHZpc2liaWxpdHkiO3M6NzoicHJpdmF0ZSI7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AGxvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aToxOTtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjUwOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQBlbmRMb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6MTk7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcUHJvcGVydHkAdHlwZSI7TjtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxQcm9wZXJ0eQByZWFkT25seSI7YjowO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFByb3BlcnR5AG1ldGFkYXRhIjthOjA6e319fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBtZXRob2RzIjthOjY6e3M6NjM6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYTo6X19jb25zdHJ1Y3QoKSI7TzozNToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QiOjEyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZG9jQmxvY2siO047czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZxc2VuIjtPOjMwOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4iOjI6e3M6Mzc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AZnFzZW4iO3M6NjM6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYTo6X19jb25zdHJ1Y3QoKSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjExOiJfX2NvbnN0cnVjdCI7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABhYnN0cmFjdCI7YjowO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmaW5hbCI7YjowO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABzdGF0aWMiO2I6MDtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAdmlzaWJpbGl0eSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5IjoxOntzOjUxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5AHZpc2liaWxpdHkiO3M6NjoicHVibGljIjt9czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFyZ3VtZW50cyI7YToxOntpOjA7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudCI6NTp7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAbmFtZSI7czozOiJlbnYiO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AHR5cGUiO086Mzg6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xPYmplY3RfIjoxOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXE9iamVjdF8AZnFzZW4iO086MzA6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbiI6Mjp7czozNzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBmcXNlbiI7czoxNzoiXFR3aWdcRW52aXJvbm1lbnQiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czoxMToiRW52aXJvbm1lbnQiO319czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAZGVmYXVsdCI7TjtzOjUwOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABieVJlZmVyZW5jZSI7YjowO3M6NDk6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AGlzVmFyaWFkaWMiO2I6MDt9fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABsb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6MjE7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0ODoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGVuZExvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aTozMTtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAcmV0dXJuVHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXE1peGVkXyI6MDp7fXM6NTc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABoYXNSZXR1cm5CeVJlZmVyZW5jZSI7YjowO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABtZXRhZGF0YSI7YTowOnt9fXM6NjE6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYTo6ZG9EaXNwbGF5KCkiO086MzU6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kIjoxMjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGRvY0Jsb2NrIjtOO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjYxOiJcX19Ud2lnVGVtcGxhdGVfZjA3MTE1YmJhODNjZjAwOWM4YzFiYmE4MDIxYmJhMmE6OmRvRGlzcGxheSgpIjtzOjM2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAG5hbWUiO3M6OToiZG9EaXNwbGF5Ijt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFic3RyYWN0IjtiOjA7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZpbmFsIjtiOjA7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHN0YXRpYyI7YjowO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAB2aXNpYmlsaXR5IjtPOjM5OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkiOjE6e3M6NTE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkAdmlzaWJpbGl0eSI7czo5OiJwcm90ZWN0ZWQiO31zOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAYXJndW1lbnRzIjthOjI6e2k6MDtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50Ijo1OntzOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABuYW1lIjtzOjc6ImNvbnRleHQiO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AHR5cGUiO086Mzc6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xBcnJheV8iOjM6e3M6MTI6IgAqAHZhbHVlVHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXE1peGVkXyI6MDp7fXM6MTA6IgAqAGtleVR5cGUiO047czoxNzoiACoAZGVmYXVsdEtleVR5cGUiO086Mzk6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xDb21wb3VuZCI6Mjp7czo1MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xBZ2dyZWdhdGVkVHlwZQB0eXBlcyI7YToyOntpOjA7TzozODoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXFN0cmluZ18iOjA6e31pOjE7TzozODoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXEludGVnZXIiOjA6e319czo1MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxUeXBlc1xBZ2dyZWdhdGVkVHlwZQB0b2tlbiI7czoxOiJ8Ijt9fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50AGRlZmF1bHQiO047czo1MDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAYnlSZWZlcmVuY2UiO2I6MDtzOjQ5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABpc1ZhcmlhZGljIjtiOjA7fWk6MTtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEFyZ3VtZW50Ijo1OntzOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABuYW1lIjtzOjY6ImJsb2NrcyI7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAdHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXEFycmF5XyI6Mzp7czoxMjoiACoAdmFsdWVUeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9czoxMDoiACoAa2V5VHlwZSI7TjtzOjE3OiIAKgBkZWZhdWx0S2V5VHlwZSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXENvbXBvdW5kIjoyOntzOjUyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXEFnZ3JlZ2F0ZWRUeXBlAHR5cGVzIjthOjI6e2k6MDtPOjM4OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcU3RyaW5nXyI6MDp7fWk6MTtPOjM4OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcSW50ZWdlciI6MDp7fX1zOjUyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXEFnZ3JlZ2F0ZWRUeXBlAHRva2VuIjtzOjE6InwiO319czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAZGVmYXVsdCI7czoyOiJbXSI7czo1MDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQXJndW1lbnQAYnlSZWZlcmVuY2UiO2I6MDtzOjQ5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxBcmd1bWVudABpc1ZhcmlhZGljIjtiOjA7fX1zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjMzO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDg6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABlbmRMb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6OTkwO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAByZXR1cm5UeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9czo1NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGhhc1JldHVybkJ5UmVmZXJlbmNlIjtiOjA7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAG1ldGFkYXRhIjthOjA6e319czo2NzoiXF9fVHdpZ1RlbXBsYXRlX2YwNzExNWJiYTgzY2YwMDljOGMxYmJhODAyMWJiYTJhOjpnZXRUZW1wbGF0ZU5hbWUoKSI7TzozNToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QiOjEyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZG9jQmxvY2siO047czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZxc2VuIjtPOjMwOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4iOjI6e3M6Mzc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AZnFzZW4iO3M6Njc6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYTo6Z2V0VGVtcGxhdGVOYW1lKCkiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czoxNToiZ2V0VGVtcGxhdGVOYW1lIjt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFic3RyYWN0IjtiOjA7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZpbmFsIjtiOjA7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHN0YXRpYyI7YjowO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAB2aXNpYmlsaXR5IjtPOjM5OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkiOjE6e3M6NTE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkAdmlzaWJpbGl0eSI7czo2OiJwdWJsaWMiO31zOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAYXJndW1lbnRzIjthOjA6e31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjk5MjtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjQ4OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZW5kTG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjk5NTtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAcmV0dXJuVHlwZSI7TzozNzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFR5cGVzXE1peGVkXyI6MDp7fXM6NTc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABoYXNSZXR1cm5CeVJlZmVyZW5jZSI7YjowO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABtZXRhZGF0YSI7YTowOnt9fXM6NjM6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYTo6aXNUcmFpdGFibGUoKSI7TzozNToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QiOjEyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZG9jQmxvY2siO047czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZxc2VuIjtPOjMwOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4iOjI6e3M6Mzc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AZnFzZW4iO3M6NjM6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYTo6aXNUcmFpdGFibGUoKSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjExOiJpc1RyYWl0YWJsZSI7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABhYnN0cmFjdCI7YjowO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmaW5hbCI7YjowO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABzdGF0aWMiO2I6MDtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAdmlzaWJpbGl0eSI7TzozOToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5IjoxOntzOjUxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxWaXNpYmlsaXR5AHZpc2liaWxpdHkiO3M6NjoicHVibGljIjt9czo0NjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFyZ3VtZW50cyI7YTowOnt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGxvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aTo5OTc7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0ODoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGVuZExvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aToxMDAwO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAByZXR1cm5UeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9czo1NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGhhc1JldHVybkJ5UmVmZXJlbmNlIjtiOjA7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAG1ldGFkYXRhIjthOjA6e319czo2NDoiXF9fVHdpZ1RlbXBsYXRlX2YwNzExNWJiYTgzY2YwMDljOGMxYmJhODAyMWJiYTJhOjpnZXREZWJ1Z0luZm8oKSI7TzozNToicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QiOjEyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAZG9jQmxvY2siO047czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZxc2VuIjtPOjMwOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4iOjI6e3M6Mzc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AZnFzZW4iO3M6NjQ6IlxfX1R3aWdUZW1wbGF0ZV9mMDcxMTViYmE4M2NmMDA5YzhjMWJiYTgwMjFiYmEyYTo6Z2V0RGVidWdJbmZvKCkiO3M6MzY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cRnFzZW4AbmFtZSI7czoxMjoiZ2V0RGVidWdJbmZvIjt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFic3RyYWN0IjtiOjA7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZpbmFsIjtiOjA7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHN0YXRpYyI7YjowO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAB2aXNpYmlsaXR5IjtPOjM5OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkiOjE6e3M6NTE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkAdmlzaWJpbGl0eSI7czo2OiJwdWJsaWMiO31zOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAYXJndW1lbnRzIjthOjA6e31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjEwMDI7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0ODoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGVuZExvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aToxMDA1O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAByZXR1cm5UeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9czo1NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGhhc1JldHVybkJ5UmVmZXJlbmNlIjtiOjA7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAG1ldGFkYXRhIjthOjA6e319czo2ODoiXF9fVHdpZ1RlbXBsYXRlX2YwNzExNWJiYTgzY2YwMDljOGMxYmJhODAyMWJiYTJhOjpnZXRTb3VyY2VDb250ZXh0KCkiO086MzU6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kIjoxMjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGRvY0Jsb2NrIjtOO3M6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZABmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjY4OiJcX19Ud2lnVGVtcGxhdGVfZjA3MTE1YmJhODNjZjAwOWM4YzFiYmE4MDIxYmJhMmE6OmdldFNvdXJjZUNvbnRleHQoKSI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjE2OiJnZXRTb3VyY2VDb250ZXh0Ijt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGFic3RyYWN0IjtiOjA7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGZpbmFsIjtiOjA7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAHN0YXRpYyI7YjowO3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAB2aXNpYmlsaXR5IjtPOjM5OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkiOjE6e3M6NTE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXFZpc2liaWxpdHkAdmlzaWJpbGl0eSI7czo2OiJwdWJsaWMiO31zOjQ2OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAYXJndW1lbnRzIjthOjA6e31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxNZXRob2QAbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjEwMDc7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBjb2x1bW5OdW1iZXIiO2k6MDt9czo0ODoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGVuZExvY2F0aW9uIjtPOjMzOiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24iOjI6e3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AbGluZU51bWJlciI7aToxOTE4O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXE1ldGhvZAByZXR1cm5UeXBlIjtPOjM3OiJwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cVHlwZXNcTWl4ZWRfIjowOnt9czo1NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAGhhc1JldHVybkJ5UmVmZXJlbmNlIjtiOjA7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcTWV0aG9kAG1ldGFkYXRhIjthOjA6e319fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwB1c2VkVHJhaXRzIjthOjA6e31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AbG9jYXRpb24iO086MzM6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbiI6Mjp7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxMb2NhdGlvbgBsaW5lTnVtYmVyIjtpOjE2O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDg6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBlbmRMb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6MTkxOTtzOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGNvbHVtbk51bWJlciI7aTowO31zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AbWV0YWRhdGEiO2E6MDp7fX19czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbnRlcmZhY2VzIjthOjA6e31zOjQxOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHRyYWl0cyI7YTowOnt9czo0MDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBlbnVtcyI7YTowOnt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBtZXRhZGF0YSI7YTowOnt9fQ==";